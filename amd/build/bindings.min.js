define("tiny_widgethub/bindings",["exports","jquery","./util"],(function(_exports,_jquery,_util){var obj;
/**
   * Tiny WidgetHub plugin.
   *
   * @module      tiny_widgethub/plugin
   * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.performCasting=_exports.createBinding=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};const performCasting=function(value,type){if(!type||typeof value===type)return value;switch(type){case"boolean":value=1===value||"1"===value||!0===value||"true"===value;break;case"number":try{let parsed;parsed=(value+"").indexOf(".")<0?parseInt(value):parseFloat(value),isNaN(parsed)?(value=0,console.error(`Error parsing number ${value}`)):value=parsed}catch(ex){value=0,console.error(`Error parsing number ${value}`)}break;case"string":"object"==typeof value?value=JSON.stringify(value):value+="";break;default:console.error(`Fail to cast ${value} to ${type}`)}return value};_exports.performCasting=performCasting;const xor=function(a,b){return!a!=!b},replaceStrPart=function(str,match,replacement){if(!match.indices)return console.error("RegExp match does not include indices"),str;const[a,b]=match.indices[1];return str.substring(0,a)+replacement+str.substring(b)},getValueFromRegex=function(regexExpr,replacement){let capturingGroupCount=0;return regexExpr.replace(/\((?!\?:).*?\)/g,(()=>(capturingGroupCount++,1===capturingGroupCount?replacement+"":"")))},bindingFactory=function(el){const methods={hasClass:(className,query,neg)=>{let elem=el;return query&&(elem=el.querySelector(query)),{getValue:()=>{var _elem,_elem$classList;const res=xor(neg,null===(_elem=elem)||void 0===_elem||null===(_elem$classList=_elem.classList)||void 0===_elem$classList?void 0:_elem$classList.contains(className));return Boolean(res)},setValue:bool=>{var _elem2,_elem3;xor(neg,bool)?null===(_elem2=elem)||void 0===_elem2||_elem2.classList.add(className):null===(_elem3=elem)||void 0===_elem3||_elem3.classList.remove(className)}}},notHasClass:(className,query)=>methods.hasClass(className,query,!0),classRegex:(classExpr,query,castTo)=>{let elem=el;return query&&(elem=el.querySelector(query)),{getValue:()=>{var _elem4;let ret="";const classes=Array.from((null===(_elem4=elem)||void 0===_elem4?void 0:_elem4.classList)??[]);for(const clazz of classes){const match=new RegExp(classExpr).exec(clazz);if(null!=match&&match[1]&&"string"==typeof match[1]){ret=match[1];break}}return performCasting(ret,castTo)},setValue:val=>{var _elem5;const cl=Array.from((null===(_elem5=elem)||void 0===_elem5?void 0:_elem5.classList)??[]);let found=!1;if(cl.forEach((c=>{var _elem6,_elem7;const match=new RegExp(classExpr,"d").exec(c);if(null===match)return;found=!0,null===(_elem6=elem)||void 0===_elem6||_elem6.classList.remove(c);const newCls=replaceStrPart(c,match,val+"");null===(_elem7=elem)||void 0===_elem7||_elem7.classList.add(newCls)})),!found){var _elem8;const newCls=getValueFromRegex(classExpr,val+"");null===(_elem8=elem)||void 0===_elem8||_elem8.classList.add(newCls)}}}},attr:(attrName,query,castTo)=>{let elem=el;return query&&(elem=el.querySelector(query)),{getValue:()=>{var _elem9;let attrValue=null===(_elem9=elem)||void 0===_elem9?void 0:_elem9.getAttribute(attrName);var _elem10;attrName.indexOf("-bs-")>0&&(attrValue=attrValue??(null===(_elem10=elem)||void 0===_elem10?void 0:_elem10.getAttribute(attrName.replace("-bs-","-"))));return performCasting(attrValue,castTo)},setValue:val=>{var _elem11;"boolean"==typeof val&&(val=val?1:0);const attrVal=val+"";var _elem12,_elem13;(null===(_elem11=elem)||void 0===_elem11||_elem11.setAttribute(attrName,attrVal),attrName.indexOf("-bs-")>0)&&(null===(_elem12=elem)||void 0===_elem12||_elem12.setAttribute(attrName.replace("-bs-","-"),attrVal));"href"!==attrName&&"src"!==attrName||(null===(_elem13=elem)||void 0===_elem13||_elem13.setAttribute("data-mce-"+attrName,attrVal))}}},attrBS:(attrName,query,castTo,version)=>{let elem=el;return query&&(elem=el.querySelector(query)),{getValue:()=>{var _elem14;let p1="",p2="bs-";5===version&&(p1=p2,p2="");let value=null===(_elem14=elem)||void 0===_elem14?void 0:_elem14.getAttribute("data-"+p1+attrName);var _elem15;void 0===value&&(value=null===(_elem15=elem)||void 0===_elem15?void 0:_elem15.getAttribute("data-"+p2+attrName));return performCasting(value||"",castTo)},setValue:val=>{var _elem16;"boolean"==typeof val&&(val=val?1:0);const attrVal=val+"";var _elem17,_elem18;(null===(_elem16=elem)||void 0===_elem16||_elem16.setAttribute("data-bs-"+attrName,attrVal),5===version)?null===(_elem17=elem)||void 0===_elem17||_elem17.removeAttribute("data-"+attrName):null===(_elem18=elem)||void 0===_elem18||_elem18.setAttribute("data-"+attrName,attrVal)}}},hasAttr:(attr,query,neg)=>{let elem=el;query&&(elem=el.querySelector(query));const parts=attr.split("="),attrName=parts[0].trim();let attrValue="";return parts.length>1&&(attrValue=parts[1].trim()),{getValue:()=>{var _elem19;let found=null!==(null===(_elem19=elem)||void 0===_elem19?void 0:_elem19.getAttribute(attrName));var _elem20;attrValue&&(found=found&&(null===(_elem20=elem)||void 0===_elem20?void 0:_elem20.getAttribute(attrName))===attrValue);return xor(neg,found)},setValue:bool=>{var _elem21,_elem22,_elem23,_elem24;xor(neg,bool)?(null===(_elem21=elem)||void 0===_elem21||_elem21.setAttribute(attrName,attrValue||""),("href"===attrName||"src"===attrName)&&(null===(_elem22=elem)||void 0===_elem22||_elem22.setAttribute("data-mce-"+attrName,attrValue+""))):(null===(_elem23=elem)||void 0===_elem23||_elem23.removeAttribute(attrName),("href"===attrName||"src"===attrName)&&(null===(_elem24=elem)||void 0===_elem24||_elem24.removeAttribute("data-mce-"+attrName)))}}},hasAttrBS:(attr,query,neg,version)=>{let elem=el;query&&(elem=el.querySelector(query));const parts=attr.split("="),attrName=parts[0].trim();let attrValue="";parts.length>1&&(attrValue=parts[1].trim());const getValuePrefix=prefix=>{var _elem25;let found=null!==(null===(_elem25=elem)||void 0===_elem25?void 0:_elem25.getAttribute(prefix+attrName));var _elem26;attrValue&&(found=found&&(null===(_elem26=elem)||void 0===_elem26?void 0:_elem26.getAttribute(prefix+attrName))===attrValue);return xor(neg,found)};return{getValue:()=>{let p1="data-",p2="data-bs-";return 5===version&&(p2=p1,p1="data-bs-"),getValuePrefix(p1)||getValuePrefix(p2)},setValue:bool=>{var _elem27,_elem28,_elem29,_elem30,_elem31;xor(neg,bool)?(null===(_elem27=elem)||void 0===_elem27||_elem27.setAttribute("data-bs-"+attrName,attrValue||""),5===version?null===(_elem28=elem)||void 0===_elem28||_elem28.removeAttribute("data-"+attrName):null===(_elem29=elem)||void 0===_elem29||_elem29.setAttribute("data-"+attrName,attrValue||"")):(null===(_elem30=elem)||void 0===_elem30||_elem30.removeAttribute("data-"+attrName),null===(_elem31=elem)||void 0===_elem31||_elem31.removeAttribute("data-bs-"+attrName))}}},notHasAttr:(attr,query)=>methods.hasAttr(attr,query,!0),attrRegex:function(attr,query,castTo){let elem=el;query&&(elem=el.querySelector(query));const parts=attr.split("="),attrName=parts[0].trim();let attrValue="";return parts.length>1&&(attrValue=parts[1].trim()),{getValue(){var _elem32;if(null!==(null===(_elem32=elem)||void 0===_elem32?void 0:_elem32.getAttribute(attrName))){var _elem33,_elem33$getAttribute;const match=null===(_elem33=elem)||void 0===_elem33||null===(_elem33$getAttribute=_elem33.getAttribute(attrName))||void 0===_elem33$getAttribute?void 0:_elem33$getAttribute.match(attrValue);return null!=match&&match[1]&&"string"==typeof match[1]?performCasting(match[1],castTo):""}return null},setValue(val){var _elem34,_elem35;const oldValue=(null===(_elem34=elem)||void 0===_elem34?void 0:_elem34.getAttribute(attrName))??"",match=new RegExp(attrValue,"d").exec(oldValue);let newValue;var _elem36;(newValue=match?replaceStrPart(oldValue,match,val+""):getValueFromRegex(attrValue,val+""),null===(_elem35=elem)||void 0===_elem35||_elem35.setAttribute(attrName,newValue),"href"===attrName||"src"===attrName)&&(null===(_elem36=elem)||void 0===_elem36||_elem36.setAttribute("data-mce-"+attrName,newValue+""))}}},hasStyle:function(sty,query,neg){let elem=el;query&&(elem=el.querySelector(query));const parts=sty.split(":");let styValue,styName=parts[0].trim();return parts.length>1&&(styValue=parts[1].trim()),{getValue(){var _elem37;const pValue=(null===(_elem37=elem)||void 0===_elem37?void 0:_elem37.style).getPropertyValue(styName);return xor(void 0===styValue?""!==pValue:pValue===styValue,neg)},setValue(bool){var _elem38,_elem39;const st=null===(_elem38=elem)||void 0===_elem38?void 0:_elem38.style;xor(bool,neg)?null==st||st.setProperty(styName,styValue??""):null==st||st.removeProperty(styName),null===(_elem39=elem)||void 0===_elem39||_elem39.setAttribute("data-mce-style",(null==st?void 0:st.cssText)??"")}}},notHasStyle:(sty,query)=>methods.hasStyle(sty,query,!0),styleRegex:function(attr,query,castTo){let elem=el;query&&(elem=el.querySelector(query));const parts=attr.split(":"),styName=parts[0].trim();let styValue="";return parts.length>1&&(styValue=parts[1].trim()),{getValue(){var _elem40;const st=null===(_elem40=elem)||void 0===_elem40?void 0:_elem40.style,currentVal=null==st?void 0:st.getPropertyValue(styName);if(currentVal){if(!styValue)return performCasting(currentVal,castTo);{const match=new RegExp(styValue).exec(currentVal);if(null!=match&&match[1]&&"string"==typeof match[1])return performCasting(match[1],castTo)}}return performCasting("",castTo)},setValue(val){var _elem41,_elem42;let newValue;const st=null===(_elem41=elem)||void 0===_elem41?void 0:_elem41.style;if(styValue)if((styName.includes("width")||styName.includes("height"))&&parseFloat(val+"")<=0)newValue="";else{const oldValue=(null==st?void 0:st.getPropertyValue(styName))??"";if(oldValue){const match=new RegExp(styValue,"d").exec(oldValue);newValue=replaceStrPart(oldValue,match,val+"")}else newValue=styValue.replace("(.*)",val+"")}else newValue=val+"";null==st||st.setProperty(styName,newValue),null===(_elem42=elem)||void 0===_elem42||_elem42.setAttribute("data-mce-style",(null==st?void 0:st.cssText)||"")}}}};return methods};_exports.createBinding=(definition,elem,castTo)=>{let bindFn=null;return"string"==typeof definition?(0,_util.evalInContext)({...bindingFactory(elem)},definition,!0):(bindFn={getValue:()=>{let v;return definition.getValue?v=(0,_util.evalInContext)({elem:elem},`(${definition.getValue})(elem)`):definition.get&&(v=(0,_util.evalInContext)({elem:(0,_jquery.default)(elem)},`(${definition.get})(elem)`)),castTo&&(v=performCasting(v,castTo)),v},setValue:v=>{definition.setValue?(0,_util.evalInContext)({elem:elem,v:v},`(${definition.setValue})(elem, v)`):definition.set&&(0,_util.evalInContext)({elem:(0,_jquery.default)(elem),v:v},`(${definition.set})(elem, v)`)}},bindFn)}}));

//# sourceMappingURL=bindings.min.js.map