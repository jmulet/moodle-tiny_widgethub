{"version":3,"file":"context_menu.min.js","sources":["../../src/trash/context_menu.js"],"sourcesContent":["/* eslint-disable no-eq-null */\n/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny WidgetHub plugin.\n *\n * @module      tiny_widgethub/plugin\n * @copyright   2024 Josep Mulet Pol <pmulet@iedib.net>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport { getGlobalConfig, getWidgetDict, getUserId } from './options';\nimport jQuery from 'jquery';\nimport contextMenuActions from './context_menu_actions';\nimport { WidgetWrapper, convertInt, findVariableByName, isUserAllowed } from './util';\n\n/**\n * @typedef PathResult\n * @property {HTMLElement} clickedElem\n * @property {WidgetWrapper} snpt\n * @property {HTMLElement} elem\n */\n\n/**\n * @param {HTMLElement} elem\n * @param {string | string[]} selectors\n * @returns {boolean}\n */\nconst matchesSelectors = function(elem, selectors) {\n    let selector = selectors;\n    let extraQuery = [];\n    if (Array.isArray(selectors)) {\n        selector = selectors[0];\n        if (selectors.length > 1) {\n            extraQuery = selectors.slice(1);\n        }\n    }\n    let match = elem.matches(selector);\n    if (match) {\n        extraQuery.forEach(e => {\n            match = match && elem.querySelector(e) != null;\n        });\n    }\n    return match;\n};\n\n/**\n * @param {WidgetWrapper[]} widgetList\n * @param {HTMLElement} clickedElem\n * @returns {PathResult}\n */\nconst findWidgetOnEventPath = function(widgetList, clickedElem) {\n    const result = {\n        clickedElem: clickedElem\n    };\n    let elem = clickedElem;\n    const componentsLength = widgetList.length;\n    while (elem != null && elem.getAttribute(\"name\") !== \"BODY\" && result.snpt == null) {\n        let i = 0;\n        while (i < componentsLength && result.snpt == null) {\n            if (matchesSelectors(elem, widgetList[i].selectors)) {\n                result.snpt = widgetList[i];\n                result.elem = elem;\n            }\n            i++;\n        }\n        elem = elem.parentElement;\n    }\n    return result;\n};\n\n\nconst contextMenuItems = {\n    \"@edit\": function() {\n        this.uiContextMenu.addMenuItem(\"Edita\", contextMenuActions[\"@edit\"].bind(this), \"fas fa fa-cog\");\n    },\n    \"@unpack\": function() {\n        this.uiContextMenu.addSeparator();\n        this.uiContextMenu.addMenuItem(\"Desempaquetar\", contextMenuActions[\"@unpack\"].bind(this), \"fas fa fa-external-link\");\n    },\n    \"@cut\": function() {\n        this.uiContextMenu.addMenuItem(\"Retallar\", contextMenuActions[\"@clipboard/cut\"].bind(this), \"fas fa fa-scissors\");\n    },\n    \"@paste\": function() {\n        const subMenu = this.uiContextMenu.addSubMenu(\"Enganxar\");\n        this.clipBoard.forEach((content, indx) => {\n            const desc = content.split(\"@@\")[0];\n            subMenu.addMenuItem((indx + 1) + \". \" + desc, contextMenuActions[\"@clipboard/paste\"].bind(this), \"\", {pos: indx + \"\"});\n        });\n        // Also includes a clear clipboard item\n        subMenu\n            .endSubMenu()\n            .addSeparator()\n            .addMenuItem(\"Buidar portaretalls\", contextMenuActions[\"@clipboard/clear\"].bind(this));\n    },\n    \"menu-pestanyes2\": function() {\n        // If in the middle of the path there is a A tab, then apply actions per tab\n        const theTab = this.currentContext.clickedElem.closest('a[data-toggle=\"tab\"]');\n        this.currentContext.theTab = theTab;\n        if (theTab) {\n            this.uiContextMenu\n                .addSubMenu(\"Afegir pestanya\", \"fas fa fa-plus\")\n                .addMenuItem(\"Abans\", contextMenuActions[\"tabs/add\"].bind(this), \"\", {before: \"true\"})\n                .addMenuItem(\"Després\", contextMenuActions[\"tabs/add\"].bind(this), \"\")\n                .endSubMenu()\n                .addSubMenu(\"Moure\", \"fas fa fa-arrows-h\")\n                .addMenuItem(\"Abans\", contextMenuActions[\"tabs/move\"].bind(this), \"fas fa fa-arrow-left\", { before: \"true\" })\n                .addMenuItem(\"Després\", contextMenuActions[\"tabs/move\"].bind(this), \"fas fa fa-arrow-right\")\n                .endSubMenu()\n                .addMenuItem(\"Eliminar pestanya\", contextMenuActions[\"tabs/del\"].bind(this), \"fa fas fa-trash\");\n        } else {\n            // Només ha d'afegir pestanya al final\n            this.uiContextMenu.addMenuItem(\"Afegir pestanya\", contextMenuActions[\"tabs/add\"].bind(this), \"fas fa fa-plus\");\n        }\n    },\n    \"imatge\": function() {\n        const effect = this.currentContext.elem.dataset.snptd;\n        if (effect === \"zoom\" || effect === \"lightbox\") {\n            this.uiContextMenu.addMenuItem(\"Eliminar efecte \" + effect, contextMenuActions[\"imatge\"].bind(this), \"fa fas fa-trash\");\n        } else {\n            this.uiContextMenu.addSubMenu(\"Efectes d'imatge\")\n                .addMenuItem(\"Afegir zoom\", contextMenuActions[\"imatge\"].bind(this), \"\", {effect: \"zoom\"})\n                .addMenuItem(\"A pantalla completa\", contextMenuActions[\"imatge\"].bind(this), \"\", {effect: \"lightbox\"})\n                .endSubMenu();\n        }\n    },\n    \"imatge-fons\": function() {\n        this.uiContextMenu.addMenuItem(\"Canviar fons\", contextMenuActions[\"imatge-fons\"].bind(this));\n    },\n    \"two-cols\": function() {\n        const subMenu = this.uiContextMenu.addSubMenu(\"Mida columnes\");\n        for (let i = 2; i < 12; i = i + 2) {\n            const tpc = parseInt((100 * i / 12.0).toFixed(0));\n            const label = tpc + \"% | \" + (100 - tpc) + \"%\";\n            subMenu.addMenuItem(label, contextMenuActions[\"two-cols\"].bind(this), \"\", {cols: \"\" + i});\n        }\n        subMenu.endSubMenu()\n            .addMenuItem(\"Passar a una columna\", contextMenuActions[\"two-cols\"].bind(this), \"fa fas fa-trash\", {cols: \"rm\"});\n    },\n    \"desplegable2\": function() {\n           // Must see which tab or group was clicked\n           console.log(\"Creating desplegable2 menus on \", this.currentContext.clickedElem);\n           this.currentContext.theTab = this.currentContext.clickedElem.closest(\"div.accordion-group\");\n           // Is Accordion behavior?\n           const isAcc = jQuery(this.currentContext.elem).find(\"div.accordion-body\").attr(\"data-parent\") != null;\n\n           const howManyAccordions = this.currentContext.elem.querySelectorAll(\".accordion-group\").length;\n           const desplegableAction = contextMenuActions[\"desplegable2\"].bind(this);\n           this.uiContextMenu\n               .addSubMenu(\"Comportament\")\n               .addMenuItem(\"Individual\", desplegableAction, isAcc ? \"\" : \"fa fas fa-check\", {accordion: \"bind\"})\n               .addMenuItem(\"Accordió\", desplegableAction, isAcc ? \"fa fas fa-check\" : \"\", {accordion: \"bacc\"})\n               .endSubMenu();\n           if (howManyAccordions > 1) {\n               this.uiContextMenu\n                   .addSubMenu(\"Mou desplegable\", \"fas fa fa-arrows-v\")\n                   .addMenuItem(\"A dalt\", desplegableAction, \"fas fa fa-arrow-up\", {accordion: \"mup\"})\n                   .addMenuItem(\"A baix\", desplegableAction, \"fas fa fa-arrow-down\", {accordion: \"mdwn\"})\n                   .endSubMenu();\n           }\n           this.uiContextMenu\n               .addSubMenu(\"Afegir desplegable\", \"fas fa fa-plus\")\n               .addMenuItem(\"A dalt\", desplegableAction, \"\", {accordion: \"iup\"})\n               .addMenuItem(\"A baix\", desplegableAction, \"\", {accordion: \"idwn\"})\n               .endSubMenu()\n               .addMenuItem(\"Eliminar desplegable\", desplegableAction, \"fas fa fa-trash\", {accordion: \"rm\"})\n               .addSeparator()\n               .addMenuItem(\"Convertir a llista\", desplegableAction, \"\", {accordion: \"2list\"});\n    },\n    \"taula-predefinida\": function() {\n        let theadToggle = \"Crear una\";\n        let tfootToggle = \"Crear un\";\n        if (this.currentContext.elem.querySelector(\"thead\")) {\n            theadToggle = \"Eliminar la\";\n        }\n        if (this.currentContext.elem.querySelector(\"tfoot\")) {\n            tfootToggle = \"Eliminar el\";\n        }\n        const ampMax = convertInt((this.currentContext.elem.style.getPropertyValue(\"max-width\") || '0').replace('px', ''), 0);\n\n        const tableAction = contextMenuActions[\"taula-predefinida\"].bind(this);\n\n        this.uiContextMenu.addMenuItem(theadToggle + \" capçalera\", tableAction, \"\", {pos: \"thead\"})\n            .addMenuItem(tfootToggle + \" peu\", tableAction, \"\", {pos: \"tfoot\"})\n            .addNumericField(\"Amplada màxima (px)\", contextMenuActions[\"taula-predefinida/maxwidth\"].bind(this),\n            \"\", {value: ampMax + ''});\n\n        if (this.currentContext.elem.classList.contains(\"iedib-table\")) {\n            this.uiContextMenu.addSeparator()\n                .addMenuItem(\"Convertir a taula Bootstrap\", tableAction, \"\", {pos: \"2bs\"});\n        } else {\n            this.uiContextMenu.addSeparator()\n                .addMenuItem(\"Convertir a taula predefinida\", tableAction, \"\", {pos: \"2pf\"});\n        }\n\n        // Comportament responsiu en taules bs\n        if (this.currentContext.snpt.key === \"taula-bs\") {\n            const parent = this.currentContext.elem.parentElement;\n            const isResponsive = parent != null && parent.nodeName === \"DIV\" && parent.classList.contains(\"table-responsive\");\n            if (isResponsive) {\n                this.uiContextMenu.addSeparator()\n                    .addMenuItem(\"Eliminar responsivitat\", tableAction, \"\", {pos: \"delres\"});\n            } else {\n                this.uiContextMenu.addSeparator()\n                    .addMenuItem(\"Afegir responsivitat\", tableAction, \"\", {pos: \"addres\"});\n            }\n        }\n    },\n    \"capsa-generica\": function() {\n        const clst = this.currentContext.elem.classList;\n        let mida2 = \"gran\";\n        if (clst.contains(\"iedib-capsa-petita\")) {\n            mida2 = \"petita\";\n        }\n        const midaCapsaAction = contextMenuActions[\"capsa/mida\"].bind(this);\n        this.uiContextMenu.addSubMenu(\"Mida\")\n            .addMenuItem(\"Petita\", midaCapsaAction, mida2 === \"petita\" ? \"fa fas fa-check\" : \"\", {mida: \"petita\"})\n            // .addMenuItem(\"Mitjana\", that.midaCapsaAction, mida2 === \"mitjana\" ? \"fa fas fa-check\" : \"\",{ mida: \"mitjana\" })\n            .addMenuItem(\"Gran\", midaCapsaAction, mida2 === \"gran\" ? \"fa fas fa-check\" : \"\", {mida: \"gran\"})\n            .endSubMenu();\n\n         // Determine current language\n         const currentLang = this.currentContext.elem.dataset.lang || \"ca\";\n         // Retrieve language list\n         console.log(this.currentContext);\n         const widget = this.currentContext.snpt;\n         if (widget != null) {\n             const parameters = widget.parameters;\n             const theLangParam = findVariableByName(\"LANG\", parameters);\n             if (theLangParam?.options) {\n                const capsaAction = contextMenuActions[\"capsa\"].bind(this);\n                let oldtype = \"alerta\";\n                const subMenuTipus =\n                [\"alerta\", \"ampliacio\", \"consell\", \"important\", \"introduccio\"].map((ty) => {\n                    let icon = \"\";\n                    if (clst.contains(\"iedib-\" + ty + \"-border\")) {\n                         oldtype = ty;\n                         icon = \"fa fas fa-check\";\n                    }\n                    return {name: ty, icon: icon, ds: {type: ty}, action: capsaAction};\n                });\n                const subMenu = this.uiContextMenu.addSubMenu(\"Idioma\");\n                theLangParam.options.forEach(opt => {\n                     const icon = (opt.v === currentLang) ? \"fa fas fa-check\" : \"\";\n                     subMenu.addMenuItem(opt.l, capsaAction, icon, {lang: opt.v, oldtype: oldtype, proposat: 'false'});\n                });\n                subMenu.endSubMenu();\n\n\n                // Permet canviar de severitat de capsa (si no és tipus exemple ni de tasca/exercici)\n                const subMenu2 = this.uiContextMenu.addSubMenu(\"Tipus\");\n                subMenuTipus.forEach((e) => {\n                    subMenu2.addMenuItem(e.name, e.action, e.icon, e.ds);\n                });\n                subMenu2.endSubMenu();\n             }\n        }\n    },\n    \"capsa-exemple-cols\": function() {\n        this.uiContextMenu.addMenuItem(\n            \"Convertir a exemple 2 files\", contextMenuActions[\"capsa-exemple-cols\"].bind(this));\n    },\n    \"capsa-exemple-rows\": function() {\n        this.uiContextMenu.addMenuItem(\n            \"Convertir a exemple simple\", contextMenuActions[\"capsa-exemple-rows\"].bind(this));\n    },\n    \"tasca-exercici\": function() {\n        // Determina l'idioma actual\n        const currentLang = this.currentContext.elem.dataset.lang || \"ca\";\n        // La llista d'idiomes\n        const widget = this.currentContext.snpt;\n        if (widget == null) {\n            return;\n        }\n        const parameters = widget.parameters;\n        const theLangParam = findVariableByName(\"LANG\", parameters);\n        if (theLangParam?.options) {\n                let oldtype = \"alerta\";\n                const subMenu = this.uiContextMenu.addSubMenu(\"Idioma\");\n                const capsaAction = contextMenuActions[\"capsa\"];\n                theLangParam.options.forEach(opt => {\n                    const icon = (opt.v === currentLang) ? \"fa fas fa-check\" : \"\";\n                    subMenu.addMenuItem(opt.l, capsaAction, icon, {lang: opt.v, oldtype: oldtype, proposat: 'true'});\n                });\n                subMenu.endSubMenu();\n\n\n            const isQuizzEnabled = isUserAllowed(getGlobalConfig(this.editor)['enable.ibquizz.userlist'],\n                getUserId(this.editor) + \"\");\n            // Determina si és exercici proposat\n            const proposatDiv = this.currentContext.elem.querySelector(\"div.iedib-tasca.iedib-proposat\");\n            if (proposatDiv && isQuizzEnabled) {\n                // Té l'àrea quizz habilitada (crear un div addicional per tal de permetre més d'un grup)?\n                const allQuizzGroups = proposatDiv.querySelectorAll('div[data-quizz-group]');\n\n                if (allQuizzGroups.length === 0) {\n                    // Dona la possibilitat de posar-ho tot d'un un grup\n                    const actionToggleDS = () => {\n                        const inspoint = proposatDiv.querySelector('.iedib-inspoint');\n                        if (inspoint) {\n                            inspoint.setAttribute('data-quizz-group', '');\n                            this.handleRequires(['/sd/quizz.min.js']);\n                            this.uiContextMenu.hide();\n                            inspoint.after(document.createElement('p'));\n                        }\n                    };\n                    this.uiContextMenu.addMenuItem(\"Converteix a àrea de qüestionari\", actionToggleDS);\n                }\n            }\n        }\n    },\n    \"!ol\": function() {\n        // ! is an special key which is not an widget but detects ordered lists\n        // To set falist style and allow to start from a certain number.\n        const decorat = this.currentContext.elem.classList.contains(\"iedib-falist\");\n        const startFrom = convertInt(this.currentContext.elem.getAttribute('start'), 1);\n        const olAction = contextMenuActions[\"!ol\"].bind(this);\n        this.uiContextMenu.addSubMenu(\"Estil\")\n            .addMenuItem(\"Normal\", olAction, decorat ? \"\" : \"fa fas fa-check\", {ol: \"snorm\"})\n            .addMenuItem(\"Embellit\", olAction, decorat ? \"fa fas fa-check\" : \"\", {ol: \"sfa\"})\n            .endSubMenu()\n            .addNumericField(\"Comença en ...\", olAction, \"\", {ol: \"startAt\", value: startFrom + ''});\n    }\n};\n\ncontextMenuItems[\"dinamic-presentacio\"] = contextMenuItems[\"menu-pestanyes2\"];\ncontextMenuItems[\"image-grid\"] = contextMenuItems[\"imatge\"];\ncontextMenuItems['taula-bs'] = contextMenuItems[\"taula-predefinida\"];\n\nexport class ContextMenu {\n    static _contextMenuInstances = {};\n    /**\n    * @member {tinyMCE} editor\n    * @member {UiContextMenu} uiContextMenu\n    * @member {PathResult} currentContext\n    */\n    editor;\n    uiContextMenu;\n    currentContext;\n    clipBoard;\n    /**\n     * @param {TinyMCE} editor The tiny editor instance\n     * @returns {ContextMenu} Creates and returns the contextMenu instance\n    */\n    static getInstance(editor) {\n        if (this._contextMenuInstances[editor.id] == null) {\n            this._contextMenuInstances[editor.id] = new ContextMenu(editor);\n        }\n        return this._contextMenuInstances[editor.id];\n    }\n\n    /**\n     * @param {TinyMCE} editor\n     */\n    constructor(editor) {\n        this.editor = editor;\n        const userId = getUserId(editor);\n        this.clipBoard = JSON.parse(localStorage.getItem(\"widgethub-clipboard_\" + userId) || \"[]\");\n        console.log(\"Initializing context menu \", editor.id, editor.dom);\n        // Only keep those widgets that can be selected from DOM elements\n        const widgetList = Object.values(getWidgetDict(editor)).filter((snpt) => snpt.selectors != null);\n\n        // Manually add those which are not widgets but need a context menu\n        // Identified by ! in key\n        widgetList.push(new WidgetWrapper({\n            key: \"!ol\",\n            name: \"Llista enumerada\",\n            selectors: \"ol\"\n        }));\n\n        const textArea = document.getElementById(editor.id);\n        const iFrame = textArea.parentElement.querySelector(\"iframe\");\n        editor.on(\"contextmenu longpress\", (evt) => {\n            // Bind actions here\n            console.log(evt);\n            const result = findWidgetOnEventPath(widgetList, evt.target);\n            this.currentContext = result;\n            if (!this.uiContextMenu) {\n                this.uiContextMenu = new UiContextMenu(this);\n            } else {\n                this.uiContextMenu.hide();\n            }\n            this.clipBoard = JSON.parse(localStorage.getItem(\"widgethub-clipboard_\" + userId) || \"[]\");\n            if (result.snpt) {\n                // Disable other menus\n                evt.preventDefault();\n                // Build the context menu for this widget and display it\n                console.log(\"Generating contextmenu for result \", result);\n                this.uiContextMenu.clear();\n                this.uiContextMenu.setTitle(result.snpt.name);\n\n                // Should we include an Edit button?\n                if (result.snpt.hasBindings()) {\n                    contextMenuItems[\"@edit\"].call(this);\n                    this.uiContextMenu.addSeparator();\n                }\n\n                // Add any other menu item designed for this widget\n                if (contextMenuItems[result.snpt.key]) {\n                    console.log(\"Adding specific items for \", result.snpt.key);\n                    contextMenuItems[result.snpt.key].call(this);\n                }\n\n                // Is this widget unpackable?\n                if (result.snpt.unpack != null) {\n                    contextMenuItems[\"@unpack\"].call(this);\n                }\n\n                // Add cut action\n                contextMenuItems[\"@cut\"].call(this);\n\n                // Is there any item in the clipboard?\n                if (this.clipBoard.length) {\n                    contextMenuItems[\"@paste\"].call(this);\n                }\n\n                const rect = iFrame.getBoundingClientRect();\n                this.uiContextMenu.show(evt.clientX + rect.left, evt.clientY + rect.top, evt);\n            } else {\n                // ALTERNATIVES\n                let toBeShown = false;\n                this.uiContextMenu.clear();\n                // No widget found, but might have clipboard items\n                if (evt.target.nodeName === 'IMG') {\n                    this.currentContext.elem = evt.target;\n                    this.uiContextMenu.setTitle(\"Imatge\");\n                    this.uiContextMenu.addMenuItem(\"Convertir a widget imatge\", contextMenuActions[\"!img\"].bind(\"this\"));\n                    evt.preventDefault();\n                    toBeShown = true;\n                }\n                // Is there content in the clipboard?\n                if (this.clipBoard.length) {\n                    toBeShown = true;\n                    // Disable other menus\n                    evt.preventDefault();\n                    this.uiContextMenu.setTitle(\"Portaretalls\");\n                    contextMenuItems[\"@paste\"].call(this);\n                }\n                // Show the context menu\n                if (toBeShown) {\n                    const rect = iFrame.getBoundingClientRect();\n                    this.uiContextMenu.show(evt.clientX + rect.left, evt.clientY + rect.top, evt);\n                }\n            }\n        });\n        // Hide de context menu when clicking on the main window (outside the editor)\n        jQuery(\"body\").on(\"click\", (evt) => {\n            if (!evt.target.closest(\".dropdown-menu.ib-bsdialog\")) {\n                this.hide();\n            }\n        });\n    }\n    hide() {\n        this.uiContextMenu?.hide();\n    }\n}\n\n\nconst SPACER = '<i style=\"display: inline-block;margin-left: 14px;\"></i> ';\n/**\n * This class defines a submenu item in the context menu UI\n */\nclass UiContextSubMenu {\n    /**\n     * @member {UiContextMenu | UiContextSubMenu} theParent\n     */\n    theParent;\n    /**\n     * @member {JQuery<HTMLElement>} theParent\n     */\n    $submenu;\n\n    /**\n     * @param {UiContextMenu | UiContextSubMenu} theParent\n     * @param {string} name\n     * @param {string?} icon\n     */\n    constructor(theParent, name, icon) {\n        this.theParent = theParent;\n        const icona = icon ? `<i class=\"${icon}\" style=\"color:gray;width:14px;\"></i>` : SPACER;\n        const $elem =\n        jQuery(`<li class=\"dropdown-submenu\"><a class=\"moodle-dialogue dropdown-item\" href=\"#\">${icona} ${name}</a></li>`);\n        this.$submenu = jQuery('<ul class=\"dropdown-menu\"></ul>');\n        $elem.append(this.$submenu);\n        this.theParent.addLevel($elem);\n    }\n\n    /**\n     * @returns {UiContextSubMenu}\n     */\n    addSeparator() {\n        // Avoid 2 separators in a row\n        if (!this.$submenu.find(\":last-child\").hasClass(\"dropdown-divider\")) {\n            this.$submenu.append(jQuery('<li class=\"dropdown-divider\"></li>'));\n        }\n        return this;\n    }\n\n    /**\n     * @param {string} name\n     * @param {function(JQuery.TriggeredEvent): void} action\n     * @param {string?} icon\n     * @param {Object} ds\n     * @returns {UiContextSubMenu}\n     */\n    addMenuItem(name, action, icon, ds) {\n        const $elem = _createDropdownItem(name, icon, ds);\n        this.$submenu.append($elem);\n        $elem.on(\"click\", action.bind(this.getRoot()));\n        return this;\n    }\n    /**\n     * @param {string} name\n     * @param {function(JQuery.TriggeredEvent): void} action\n     * @param {string?} icon\n     * @param {Object} ds\n     * @returns {UiContextSubMenu}\n     */\n    addNumericField(name, action, icon, ds) {\n        const $elem = _createNumericFieldItem(this.getRoot(), name, action, icon, ds);\n        this.$submenu.append($elem);\n        return this;\n    }\n\n    /**\n     * @returns {UiContextMenu}\n     */\n    endSubMenu() {\n        return this.theParent;\n    }\n\n    /**\n     * @returns {UiContextSubMenu}\n    */\n    endSubSubMenu() {\n        return this.theParent;\n    }\n\n    /**\n     * @returns {ContextMenu}\n     */\n    getRoot() {\n        return this.theParent.getRoot();\n    }\n\n    /**\n     * @param {JQuery<HTMLElement>} elem\n     */\n    addLevel(elem) {\n        this.$submenu.append(elem);\n    }\n\n    /**\n     * In case we need to add another level in the UiContextMenu\n     * @param {string} name\n     * @param {string?} icon\n     * @returns {UiContextSubMenu}\n     */\n    addSubMenu(name, icon) {\n        return new UiContextSubMenu(this, name, icon);\n    }\n}\n\n/**\n *\n * @param {ContextMenu} root\n * @param {string} name\n * @param {function(JQuery.TriggeredEvent): void} action\n * @param {string?} icon\n * @param {Object?} ds\n * @returns {JQuery<HTMLElement>}\n */\nfunction _createNumericFieldItem(root, name, action, icon, ds) {\n    ds = ds || {};\n    icon = icon ? ('<i class=\"' + icon + '\" style=\"color:gray;width:14px;\"></i> ') : SPACER;\n    const $elem = jQuery(`<li class=\"dropdown-item\">${icon} <span>${name}</span><br>\n    ${SPACER}&nbsp;&nbsp;<input class=\"moodle-dialogue\" type=\"number\" value=\"${ds.value}\" style=\"width:100px\"/></li>`);\n    const $input = $elem.find('input');\n    $elem.append($input);\n    if (ds != null) {\n        const keys = Object.keys(ds);\n        for (let i = 0, len = keys.length; i < len; i++) {\n            const k = keys[i];\n            const v = ds[k];\n            $input.attr(\"data-\" + k, v);\n        }\n    }\n    $input.on('change', (evt) => {\n        // Modify the value of the event\n        const newVal = $input.val();\n        if (newVal) {\n            $input.attr('data-value', $input.val() + '' || '1');\n            action.call(root, evt);\n        }\n    });\n    return $elem;\n}\n\n/**\n * @param {string} name\n * @param {string?} icon\n * @param {Object?} ds\n * @returns {JQuery<HTMLElement>}\n */\nfunction _createDropdownItem(name, icon, ds) {\n    const $elem = jQuery('<li class=\"dropdown-item\"></li>');\n    const isTrash = icon && icon.indexOf(\"trash\") > 0;\n    const styleColor = isTrash ? 'darkred' : 'gray';\n    icon = icon ? (`<i class=\"${icon}\" style=\"color:${styleColor};width:14px;\"></i> `) : SPACER;\n    const $elemA = jQuery(`<a href=\"#\" class=\"moodle-dialogue\"${isTrash ? ' style=\"color:darkred;\"' : ''}>${icon} ${name}</a>`);\n    $elem.append($elemA);\n    if (ds != null) {\n        const keys = Object.keys(ds);\n        for (let i = 0, len = keys.length; i < len; i++) {\n            const k = keys[i];\n            const v = ds[k];\n            $elem.attr(\"data-\" + k, v);\n        }\n    }\n    return $elem;\n}\n\n/**\n * Class for the root of the UIContextMenu\n */\nexport class UiContextMenu {\n    /**\n     * @member {ContextMenu} popup\n     */\n    popup;\n    /**\n     * @member {JQuery<HTMLElement>} $popupMenu\n     */\n    $popupMenu;\n    /**\n     * @member {Event?} originalEvent\n     */\n    originalEvent;\n\n    /**\n     *\n     * @param {ContextMenu} popup\n     */\n    constructor(popup) {\n        this.popup = popup;\n        this.$popupMenu = jQuery('#snpteditor_popup');\n        if (this.$popupMenu.length === 0) {\n            // eslint-disable-next-line max-len\n            this.$popupMenu = jQuery('<ul id=\"snpteditor_popup\" class=\"dropdown-menu ib-bsdialog\" role=\"menu\" style=\"-webkit-box-shadow: 4px 4px 7px 2px rgba(112,112,112,1);-moz-box-shadow: 4px 4px 7px 2px rgba(112,112,112,1);box-shadow: 4px 4px 7px 2px rgba(112,112,112,1);\"></ul>');\n            this.$popupMenu.css({\"position\": \"fixed\"});\n            jQuery('body').append(this.$popupMenu);\n        }\n    }\n\n    /**\n     * @returns {UiContextMenu}\n     */\n    addSeparator() {\n        // Avoid 2 separators in a row\n        if (!this.$popupMenu.find(\":last-child\").hasClass(\"dropdown-divider\")) {\n            this.$popupMenu.append(jQuery('<li class=\"dropdown-divider\"></li>'));\n        }\n        return this;\n    }\n    /**\n     * @param {string} name\n     * @returns {UiContextMenu}\n     */\n    addHeader(name) {\n        this.$popupMenu.append(jQuery('<li class=\"dropdown-header\">' + name + '</li>'));\n        return this;\n    }\n    /**\n     * @param {string} name\n     * @param {function(JQuery.TriggeredEvent): void} action\n     * @param {string?} icon\n     * @param {Object?} ds\n     * @returns {UiContextMenu}\n     */\n    addMenuItem(name, action, icon, ds) {\n        const $elem = _createDropdownItem(name, icon, ds);\n        this.$popupMenu.append($elem);\n        $elem.on(\"click\", action.bind(this.popup));\n        return this;\n    }\n    /**\n     * @param {string} name\n     * @param {function(JQuery.TriggeredEvent): void} action\n     * @param {string?} icon\n     * @param {Object?} ds\n     * @returns {UiContextMenu}\n     */\n    addNumericField(name, action, icon, ds) {\n        const $elem = _createNumericFieldItem(this.getRoot(), name, action, icon, ds);\n        this.$popupMenu.append($elem);\n        return this;\n    }\n    /**\n     * @param {string} name\n     * @param {string?} icon\n     * @returns {UiContextSubMenu}\n     */\n    addSubMenu(name, icon) {\n        return new UiContextSubMenu(this, name, icon);\n    }\n    /**\n     * @param {number} clientX\n     * @param {number} clientY\n     * @param {Event} originalEvent\n     */\n    show(clientX, clientY, originalEvent) {\n        // Must check if context menu will be cut?\n        const $d = jQuery(window);\n        let mw = this.$popupMenu.width() || 100;\n        let mh = this.$popupMenu.height() || 100;\n        console.log(\"Popup show:: popup w and h \", mw, mh);\n        // Check if the submenus are larger than this\n        let maxwSubmenu = 0;\n        let maxhSubmenu = 0;\n        this.$popupMenu.find('li.dropdown-submenu').each((i, ele) => {\n            const $ele = jQuery(ele);\n            const smw = ($ele.width() || 100);\n            const smh = ($ele.height() || 0);\n            if (smw > maxwSubmenu) {\n                maxwSubmenu = smw;\n            }\n            if (smh > maxhSubmenu) {\n                maxhSubmenu = smh;\n            }\n        });\n        mw = mw + maxwSubmenu;\n        mh = mh + maxhSubmenu;\n        const ww = $d.width() || 400;\n        const wh = $d.height() || 200;\n        console.log(\"Popup show:: window w and  h \", ww, wh);\n        if (clientY + mh > wh) {\n            clientY = wh - mh - 100;\n        }\n        if (clientX + mw > ww) {\n            clientX = ww - mw - 100;\n        }\n\n        this.$popupMenu.show().css({\n            left: clientX,\n            top: clientY\n        });\n        this.originalEvent = originalEvent;\n    }\n    /**\n     * @param {string} title\n     */\n    setTitle(title) {\n        this.$popupMenu.find(\"h6 > span\").text(title);\n    }\n    /**\n     * Clears all the contents of the context menu\n     */\n    clear() {\n        this.$popupMenu.find(\"a\").off();\n        this.$popupMenu.find(\"button\").off();\n        this.$popupMenu.html(\"\");\n        // Prepare the heading\n        // eslint-disable-next-line max-len\n        const $label = jQuery('<h6 class=\"dropdown-header\" style=\"border-bottom: 1px solid lightgray;transform: translateY(-8px);padding: 0.5rem 0.8rem;\"><span>Menú</span></h6>');\n        // eslint-disable-next-line max-len\n        const $closeSB = jQuery('<a class=\"moodle-dialogue\" href=\"\" title=\"Tancar\" style=\"margin-left:10px;float:right;color:gray;\"><i class=\"fad fa fa-times\"></i></a>');\n        $closeSB.on(\"click touchstart\", (e2) => {\n            e2.preventDefault();\n            this.hide();\n        });\n        $label.append($closeSB);\n        this.$popupMenu.append($label);\n    }\n    /**\n     * Hides de context menu\n     */\n    hide() {\n        this.$popupMenu.hide();\n    }\n    /**\n     * @returns {ContextMenu}\n     */\n    getRoot() {\n        return this.popup;\n    }\n    /**\n     * @param {JQuery<HTMLElement>} elem\n     */\n    addLevel(elem) {\n        this.$popupMenu.append(elem);\n    }\n}"],"names":["matchesSelectors","elem","selectors","selector","extraQuery","Array","isArray","length","slice","match","matches","forEach","e","querySelector","contextMenuItems","uiContextMenu","addMenuItem","contextMenuActions","bind","this","addSeparator","subMenu","addSubMenu","clipBoard","content","indx","desc","split","pos","endSubMenu","theTab","currentContext","clickedElem","closest","before","effect","dataset","snptd","i","tpc","parseInt","toFixed","label","cols","console","log","isAcc","find","attr","howManyAccordions","querySelectorAll","desplegableAction","accordion","theadToggle","tfootToggle","ampMax","style","getPropertyValue","replace","tableAction","addNumericField","value","classList","contains","snpt","key","parent","parentElement","nodeName","clst","mida2","midaCapsaAction","mida","currentLang","lang","widget","parameters","theLangParam","options","capsaAction","oldtype","subMenuTipus","map","ty","icon","name","ds","type","action","opt","v","l","proposat","subMenu2","isQuizzEnabled","editor","proposatDiv","actionToggleDS","inspoint","setAttribute","handleRequires","hide","after","document","createElement","decorat","startFrom","getAttribute","olAction","ol","ContextMenu","_contextMenuInstances","id","constructor","userId","JSON","parse","localStorage","getItem","dom","widgetList","Object","values","filter","push","WidgetWrapper","iFrame","getElementById","on","evt","result","componentsLength","findWidgetOnEventPath","target","UiContextMenu","preventDefault","clear","setTitle","hasBindings","call","unpack","rect","getBoundingClientRect","show","clientX","left","clientY","top","toBeShown","SPACER","UiContextSubMenu","theParent","icona","$elem","$submenu","append","addLevel","hasClass","_createDropdownItem","getRoot","_createNumericFieldItem","endSubSubMenu","root","$input","keys","len","k","val","isTrash","indexOf","styleColor","$elemA","popup","$popupMenu","css","addHeader","originalEvent","$d","window","mw","width","mh","height","maxwSubmenu","maxhSubmenu","each","ele","$ele","smw","smh","ww","wh","title","text","off","html","$label","$closeSB","e2"],"mappings":"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"}