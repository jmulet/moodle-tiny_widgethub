{"version":3,"file":"util.min.js","sources":["../src/util.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-eq-null */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-new-func */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny WidgetHub plugin.\n *\n * @module      tiny_widgethub/plugin\n * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Common from './common';\nconst {component} = Common;\n\n/**\n * @param {string} [prefix]\n * @returns {string} a randomID\n */\nexport function genID(prefix = 'g') {\n    const timePart = Date.now().toString(32);\n    const randPart = Math.floor(Math.random() * 1e6).toString(32);\n    return `${prefix}-${timePart}${randPart}`;\n}\n\n/**\n * @param {Object.<string, any>} ctx\n * @param {string} expr\n * @param {boolean=} keepFns - Keep or not the funcions in the ctx\n * @returns {any} The evaluated expression within the context ctx\n */\nexport function evalInContext(ctx, expr, keepFns) {\n    const listArgs = [];\n    const listVals = [];\n\n    if (ctx) {\n        Object.keys(ctx).forEach((key) => {\n            // Remove functions from ctx\n            if (keepFns || typeof ctx[key] !== \"function\") {\n                listArgs.push(key);\n                listVals.push(ctx[key]);\n            }\n        });\n    }\n    listArgs.push('expr');\n    listArgs.push('return eval(expr)');\n    listVals.push(expr);\n    const evaluator = new Function(...listArgs);\n    return evaluator(...listVals);\n}\n\n/**\n * @param {string} s - string to the hashed\n * @returns {number}\n */\nexport function hashCode(s) {\n    s = s || \"\";\n    let h = 0;\n    const l = s.length;\n    let i = 0;\n    if (l > 0) {\n        while (i < l) {\n            h = (h << 6) + ((s.charCodeAt(i) - 65) | 0);\n            i++;\n        }\n    }\n    return Math.abs(h);\n}\n\n/**\n * @param {string} str1\n * @param {string} needle\n * @returns {boolean} Whether str1 contains needle or not\n */\nexport function searchComp(str1, needle) {\n    str1 = (str1 || '').trim().toLowerCase();\n    needle = (needle || '').trim().toLowerCase();\n    str1 = str1.replace(/[àáâãäå]/, \"a\")\n        .replace(/[èéêë]/, \"e\")\n        .replace(/[ìíîï]/, \"i\")\n        .replace(/[òóôö]/, \"o\")\n        .replace(/[ùúüû]/, \"u\")\n        .replace(/ç/, \"c\")\n        .replace(/·/, \"\");\n    needle = needle.replace(/[àáâãäå]/, \"a\")\n        .replace(/[èéêë]/, \"e\")\n        .replace(/[ìíîï]/, \"i\")\n        .replace(/[òóôö]/, \"o\")\n        .replace(/[ùúüû]/, \"u\")\n        .replace(/ç/, \"c\")\n        .replace(/·/, \"\");\n    return str1.indexOf(needle) >= 0;\n}\n\n/** Default transformers */\nconst Transformers = {\n    /** @param {string} txt */\n    toUpperCase: function(txt) {\n        return (txt + \"\").toUpperCase();\n    },\n    /** @param {string} txt */\n    toLowerCase: function(txt) {\n        return (txt + \"\").toLowerCase();\n    },\n    /** @param {string} txt */\n    trim: function(txt) {\n        return (txt + \"\").trim();\n    },\n    /** @param {string} txt */\n    ytId: function(txt) {\n        // Finds the youtubeId in a text\n        const rx = /^.*(?:(?:youtu\\.be\\/|v\\/|vi\\/|u\\/\\w\\/|embed\\/|shorts\\/)|(?:(?:watch)?\\?v(?:i)?=|&v(?:i)?=))([^#&?]*).*/;\n        const r = (txt || '').match(rx);\n        if (r?.length) {\n            return r[1];\n        }\n        return txt;\n    },\n    /** @param {string} txt */\n    vimeoId: function(txt) {\n        const regExp = /^.*(vimeo\\.com\\/)((channels\\/[A-z]+\\/)|(groups\\/[A-z]+\\/videos\\/))?(\\d+)/;\n        const match = new RegExp(regExp).exec(txt || \"\");\n        if (match?.[5]) {\n            return match[5];\n        }\n        return txt;\n    },\n    /** @param {string} txt */\n    serveGDrive: function(txt) {\n        // Expecting https://drive.google.com/file/d/1DDUzcFrOlzWb3CBdFPJ1NCNXClvPbm5B/preview\n        const res = (txt + \"\").match(/https:\\/\\/drive.google.com\\/file\\/d\\/([a-zA-Z0-9_]+)\\//);\n        if (res?.length) {\n            const driveId = res[1];\n            return \"https://docs.google.com/uc?export=open&id=\" + driveId;\n        }\n        return txt;\n    },\n    /** @param {string} txt */\n    removeHTML: function(txt) {\n        return (txt || '').replace(/<[^>]*>?/gm, '');\n    },\n    /** @param {string} txt */\n    escapeHTML: function(txt) {\n        return (txt || '').replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#039;\");\n    },\n    /** @param {string} txt */\n    encodeHTML: function(txt) {\n        // @ts-ignore\n        return encodeURIComponent(txt || \"\");\n    },\n    /** @param {string} txt */\n    escapeQuotes: function(txt) {\n        return (txt || '').replace(/\"/gm, \"'\");\n    }\n};\n\n\nclass Builder {\n    transSeq;\n    // @ts-ignore\n    constructor(transformStr) {\n        const parts = transformStr.split('|');\n        this.transSeq = [];\n        for (let j = 0, lenj = parts.length; j < lenj; j++) {\n            const prts = parts[j].trim();\n            // @ts-ignore\n            const transfunc = Transformers[prts];\n            if (transfunc != null) {\n                this.transSeq.push(transfunc);\n            } else {\n                console.error(\"Cannot find transformer named \" + prts);\n            }\n        }\n    }\n\n    // @ts-ignore\n    reduce(text) {\n        for (let j = 0, lenj = this.transSeq.length; j < lenj; j++) {\n            const transfunc = this.transSeq[j];\n            text = transfunc(text);\n        }\n        return text;\n    }\n}\n\n/**\n * @param {string} transformStr\n * @returns {Builder} call reduce(text) function\n */\nexport function stream(transformStr) {\n    return new Builder(transformStr);\n}\n\n/**\n * @param {string} name\n * @returns {string} Replaces $ apperences by _ to make the name compatible by data attributes\n */\nexport function cleanParameterName(name) {\n    return name.replace(/\\$/g, '_');\n}\n\n/**\n * Creates a filter funcion from filterCode\n * @param {string} filterCode\n * @returns {Function?}\n */\nexport function createFilterFunction(filterCode) {\n    let userWidgetFilter = null;\n    try {\n        userWidgetFilter = new Function('text', 'editor', 'opts', filterCode);\n    } catch (ex) {\n        userWidgetFilter = null;\n        console.error(ex);\n    }\n    return userWidgetFilter;\n}\n\n/**\n * @param {import('./plugin').TinyMCE} editor\n * @param {{get_strings: (keyComponent: any[]) => Promise<string[]>}} coreStr - dependency on core/str\n * @returns {*}\n */\nexport function applyWidgetFilterFactory(editor, coreStr) {\n    /**\n     * @param {string} widgetTemplate\n     * @param {boolean} silent\n     * @param {object?} mergevars\n     * @returns {Promise<boolean>} - True if the filter can be compiled\n     */\n    return async(widgetTemplate, silent, mergevars) => {\n        const translations = await coreStr.get_strings([\n            {key: 'filterres', component},\n            {key: 'nochanges', component}\n        ]);\n        // Es tracta d'un filtre, no d'un widget i s'ha de tractar de forma diferent\n        const userWidgetFilter = createFilterFunction(widgetTemplate);\n\n        if (!userWidgetFilter) {\n            editor.notificationManager.open({\n                text: translations[0] + \": Invalid filter\",\n                type: 'danger',\n                timeout: 4000\n            });\n            return false;\n        }\n        // @ts-ignore\n        const handleFilterResult = function(res) {\n            const out = res[0];\n            let msg = res[1];\n            if (out != null) {\n                if (typeof out === \"string\") {\n                    editor.setContent(out);\n                    editor.notificationManager.open({\n                        text: translations[0] + \": \" + msg,\n                        type: 'success',\n                        timeout: 5000\n                    });\n                } else if (out === true) {\n                    editor.notificationManager.open({\n                        text: translations[0] + \": \" + msg,\n                        type: 'success',\n                        timeout: 5000\n                    });\n                } else if (out === false && !silent) {\n                    editor.notificationManager.open({\n                        text: translations[1],\n                        type: 'info',\n                        timeout: 5000\n                    });\n                }\n            } else if (!silent) {\n                editor.notificationManager.open({\n                    text: translations[1],\n                    type: 'info',\n                    timeout: 5000\n                });\n            }\n        };\n\n        const initialHTML = editor.getContent();\n        const filteredResult = userWidgetFilter(initialHTML, editor, mergevars);\n        // Hi ha la possibilitat que el filtre retorni una promesa o un array\n        const isPromise = filteredResult != null && typeof (filteredResult) === 'object' && ('then' in filteredResult);\n        if (isPromise) {\n            filteredResult.then(handleFilterResult).catch((/** @type {any} */ err) => console.error(err));\n        } else {\n            handleFilterResult(filteredResult || [null, translations[1]]);\n        }\n        return true;\n    };\n}\n\n/**\n * Safe conversion of a string to integer by handling errors and NaN values\n * In this case, the def number passed is returned\n * @param {string | undefined | null | number} str\n * @param {number} def - default value\n * @returns {number}\n */\nexport function convertInt(str, def) {\n    if (str && typeof str === 'number') {\n        return Math.floor(str);\n    }\n    if (!str || !(str + \"\").trim() || !RegExp(/^\\s*[+-]?\\d+(\\.\\d*)?\\s*$/).exec(str + \"\")) {\n        return def;\n    }\n    try {\n        const val = parseInt(str + \"\");\n        if (!isNaN(val)) {\n            return val;\n        }\n    } catch (ex) {\n        // Pass\n    }\n    return def;\n}\n\n/**\n * Finds the parameter with a given name within the list of objects\n * @param {string} varname\n * @param {import('./options').Param[]} listVars\n * @returns {import('./options').Param | null}\n */\nexport function findVariableByName(varname, listVars) {\n    if (!listVars) {\n        return null;\n    }\n    let found = null;\n    const len = listVars.length;\n    let k = 0;\n    while (k < len && !found) {\n        if (listVars[k].name === varname) {\n            found = listVars[k];\n        }\n        k++;\n    }\n    return found;\n}\n\n/**\n * Safely joins two parts of an url\n * @param {string} a\n * @param {string=} b\n * @returns {string}\n */\nexport function pathJoin(a, b) {\n    a = (a || \"\").trim();\n    b = (b || \"\").trim();\n    if (!a.endsWith('/')) {\n        a = a + '/';\n    }\n    if (b.startsWith('/')) {\n        b = b.substring(1);\n    }\n    return a + b;\n}\n\n/**\n * Adds the baseurl if the passed url does not start with http or https\n * @param {string} base\n * @param {string=} url\n * @returns {string}\n */\nexport function addBaseToUrl(base, url) {\n    url = (url || \"\").trim();\n    if (url.toLowerCase().startsWith(\"http\")) {\n        return url;\n    }\n    // Afegir la base\n    const out = pathJoin(base, url);\n    return out;\n}\n\n/**\n * Capitalizes the first letter of a string\n * @param {string | undefined | null} s\n * @returns {string}\n */\nexport const capitalize = s => (s && s[0].toUpperCase() + s.slice(1)) || \"\";\n\n/**\n * @param {string | null | undefined} color - color in hex or rgb or rgba\n * @returns {[string, number]} - The color in hex format, alpha channel 0..1\n */\nexport function toHexAlphaColor(color) {\n    color = (color || '#000000').trim().toLowerCase();\n    let alpha = 1;\n    if (color.startsWith(\"#\") && color.length === 9) {\n        // Already in hex & alpha\n        alpha = parseInt('0x' + color.substring(7)) / 255.0;\n        color = color.substring(0, 7);\n    } else if (color.startsWith('rgb')) {\n        // Assume rgb or rgba\n        const sep = color.indexOf(\",\") > -1 ? \",\" : \" \";\n        const a = color.replace(/[^\\d,]/g, \"\").split(sep);\n        color = \"#\" + ((1 << 24) + (+a[0] << 16) + (+a[1] << 8) + (+a[2])).toString(16).slice(1);\n        // Is rgba?\n        if (a.length === 4) {\n            alpha = +a[3];\n            if (alpha > 1) {\n                alpha = 0.01 * alpha;\n            }\n        }\n    }\n    return [color, alpha];\n}\n\n/**\n * @param {string | null | undefined} hex - color in hex\n * @param {number} alpha - 0..1 or 0..100\n * @returns {string} - The color in rgba syntax\n */\nexport function toRgba(hex, alpha) {\n    hex = (hex || '#000000').trim().toLowerCase();\n    /** @type {number | string} */\n    let alpha2 = alpha ?? 1;\n    if (alpha2 > 1) {\n        alpha2 *= 0.01;\n    }\n    if (alpha2 !== 0 && alpha2 !== 1) {\n        alpha2 = alpha2.toFixed(2);\n    }\n    const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})/i.exec(hex);\n    let r = 0,\n        g = 0,\n        b = 0;\n    if (result) {\n        r = parseInt(result[1], 16);\n        g = parseInt(result[2], 16);\n        b = parseInt(result[3], 16);\n    }\n    if (alpha === 1) {\n        return `rgb(${r},${g},${b})`;\n    }\n    return `rgba(${r},${g},${b},${alpha2})`;\n}\n\n/**\n * Simple debounce function\n * @param {(evt?: any) => void} cb\n * @param {number} [delay]\n */\n/**\n * Simple debounce function\n * @param {(...args: unknown[]) => void} cb\n * @param {number} [delay]\n * @returns {((...args: unknown[]) => void) & {clear: () => void}}\n */\nexport function debounce(cb, delay = 1000) {\n    /** @type{number | null} */\n    let timeoutId = null;\n    const debounced = (/** @type {unknown[]} */ ...args) => {\n        if (timeoutId) {\n            window.clearTimeout(timeoutId);\n        }\n        timeoutId = window.setTimeout(() => {\n            cb(...args);\n        }, delay);\n    };\n    debounced.clear = () => {\n        if (!timeoutId) {\n            return;\n        }\n        window.clearTimeout(timeoutId);\n        timeoutId = null;\n    };\n    return debounced;\n}\n\n/**\n * @param {HTMLElement} elem\n * @param {...string} classNames\n */\nexport function toggleClass(elem, ...classNames) {\n    const classList = elem.classList;\n    classNames.forEach(name => {\n        if (classList.contains(name)) {\n            classList.remove(name);\n        } else {\n            classList.add(name);\n        }\n    });\n}\n\n/**\n * Normalize version string to [major, minor, patch]\n * @param {string} v\n * @returns {number[]}\n */\nfunction parseVersion(v) {\n    return v\n        .split('.')\n        .map(part => Number(part.trim()))\n        .concat([0, 0])\n        .slice(0, 3);\n}\n\n/**\n * Compares a version with a given condition.\n * @param {string} current - The current version to compare against condition in major.minor.revision format\n * @param {string | null | undefined} [condition] - The condition to meet. In <, <=, =, >=, major.minor.revision\n * @returns {boolean} True if current meets condition\n */\nexport function compareVersion(current, condition) {\n    if (!condition) {\n        return true;\n    }\n\n    // Parse condition string\n    const match = condition.trim().match(/^(>=|<=|>|<|=)?\\s*(\\d+(?:\\.\\d+){0,2})$/);\n    if (!match) {\n        console.error(\"Invalid version condition: \" + condition);\n        return true;\n    }\n\n    const operator = match[1] || \"=\";\n    const targetVersion = parseVersion(match[2]);\n    const currentVersion = parseVersion(current);\n\n    // Compare versions\n    let cmp = 0;\n    for (let i = 0; i < 3; i++) {\n        if (currentVersion[i] > targetVersion[i]) {\n            cmp = 1;\n            break;\n        }\n        if (currentVersion[i] < targetVersion[i]) {\n            cmp = -1;\n            break;\n        }\n    }\n\n    // Evaluate based on operator\n    switch (operator) {\n        case \">\": return cmp > 0;\n        case \">=\": return cmp >= 0;\n        case \"<\": return cmp < 0;\n        case \"<=\": return cmp <= 0;\n        case \"=\": return cmp === 0;\n        default:\n            console.log(\"Unknown operator: \" + operator);\n            return true;\n    }\n}\n\n/**\n * Parameters that are generated from $RND must never\n * be stored as recently used, nor used as new contexts\n * @param {Record<string, any>} ctx\n * @param {import('./options').Param[]} parameters\n * @returns {Record<string, any>}\n */\nexport function removeRndFromCtx(ctx, parameters) {\n    return Object.fromEntries(\n        Object.entries(ctx).filter(([k]) => {\n            const val = parameters.find(p => p.name === k)?.value;\n            return val !== '$RND';\n        })\n    );\n}\n\n/**\n * Helper to load scripts\n * @param {import('./plugin').TinyMCE} editor\n * @param {string} src\n * @returns {Promise<void>}\n */\nexport function loadScriptAsync(editor, src) {\n    return new Promise((resolve, reject) => {\n        const s = editor.dom.create('script', {src});\n        s.onload = () => resolve();\n        s.onerror = reject;\n        const head = editor.getDoc().querySelector(\"head\");\n        head.appendChild(s);\n    });\n}\n\n/**\n * Convert an HTML string into DOM element(s)\n * @param {Document} doc - The page document\n * @param {string} html - HTML string\n * @returns {HTMLElement} - Returns a single element if one root, or a DocumentFragment if multiple\n */\nexport function htmlToElement(doc, html) {\n    const template = doc.createElement('template');\n    template.innerHTML = html.trim();\n\n    if (template.content.childElementCount === 1) {\n        // @ts-ignore\n        return template.content.firstElementChild;\n    } else {\n        // If multiple root elements, return a fragment\n        // @ts-ignore\n        return template.content;\n    }\n}\n\n/**\n * @deprecated Use native editor.dom.setStyle instead.\n * @param {HTMLElement} target\n * @param {string} propName\n * @param {string} propValue\n */\nexport function setStyleMCE(target, propName, propValue) {\n    target.style.setProperty(propName, propValue);\n    // Sync data-mce-style\n    target.setAttribute('data-mce-style', target.getAttribute('style') ?? '');\n}\n\n/**\n * @param {HTMLElement} target\n * @param {string} propName\n */\nexport function removeStyleMCE(target, propName) {\n    target.style.removeProperty(propName);\n    // Sync data-mce-style\n    target.setAttribute('data-mce-style', target.getAttribute('style') ?? '');\n}"],"names":["base","url","trim","toLowerCase","startsWith","pathJoin","editor","coreStr","async","widgetTemplate","silent","mergevars","translations","get_strings","key","component","userWidgetFilter","createFilterFunction","notificationManager","open","text","type","timeout","handleFilterResult","res","out","msg","setContent","filteredResult","getContent","then","catch","err","console","error","name","replace","current","condition","match","operator","targetVersion","parseVersion","currentVersion","cmp","i","log","str","def","Math","floor","RegExp","exec","val","parseInt","isNaN","ex","cb","delay","timeoutId","debounced","args","window","clearTimeout","setTimeout","clear","ctx","expr","keepFns","listArgs","listVals","Object","keys","forEach","push","Function","evaluator","varname","listVars","found","len","length","k","prefix","timePart","Date","now","toString","randPart","random","s","h","l","charCodeAt","abs","doc","html","template","createElement","innerHTML","content","childElementCount","firstElementChild","src","Promise","resolve","reject","dom","create","onload","onerror","getDoc","querySelector","appendChild","parameters","fromEntries","entries","filter","_ref","find","p","_parameters$find","value","target","propName","style","removeProperty","setAttribute","getAttribute","str1","needle","indexOf","propValue","setProperty","transformStr","Builder","color","alpha","substring","sep","a","split","slice","hex","alpha2","toFixed","result","r","g","b","elem","classList","classNames","contains","remove","add","Common","Transformers","toUpperCase","txt","ytId","vimeoId","serveGDrive","removeHTML","escapeHTML","encodeHTML","encodeURIComponent","escapeQuotes","transSeq","constructor","parts","j","lenj","prts","transfunc","reduce","this","filterCode","endsWith","v","map","part","Number","concat"],"mappings":"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"}