define("tiny_widgethub/commands",["exports","editor_tiny/utils","core/str","./common","core/config","./container","./contextInit","./options","editor_tiny/options","./controller/formCtrl","./controller/widgetParamsCtrl","./controller/widgetPickerCtrl","./controller/widgetPropertiesCtrl","./service/domSrv","./service/modalSrv","./service/templateSrv","./service/userStorageSrv","./util","jquery","core/mustache"],(function(_exports,_utils,coreStr,_common,cfg,_container,_contextInit,_options,_options2,_formCtrl,_widgetParamsCtrl,_widgetPickerCtrl,_widgetPropertiesCtrl,_domSrv,_modalSrv,_templateSrv,_userStorageSrv,_util,_jquery,_mustache){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}
/**
   * Tiny WidgetHub plugin.
   *
   * @module      tiny_widgethub/plugin
   * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=_exports.ejsLoader=_exports.FileSrv=void 0,coreStr=_interopRequireWildcard(coreStr),_common=_interopRequireDefault(_common),cfg=_interopRequireWildcard(cfg),_widgetPropertiesCtrl=_interopRequireDefault(_widgetPropertiesCtrl),_jquery=_interopRequireDefault(_jquery),_mustache=_interopRequireDefault(_mustache);_exports.getSetup=async()=>{const[widgetNameTitle,buttonImage]=await Promise.all([(0,coreStr.get_string)("settings",_common.default.component),(0,_utils.getButtonImage)("icon",_common.default.component)]);return editor=>{if(!(0,_options.isPluginVisible)(editor))return;editor.ui.registry.addIcon(_common.default.icon,buttonImage.html);const defaultAction=()=>{_container.DIContainer.init(editor).get("widgetPickCtrl").handleAction()};editor.ui.registry.addButton(_common.default.component,{icon:_common.default.icon,tooltip:widgetNameTitle,onAction:defaultAction}),editor.ui.registry.addMenuItem(_common.default.component,{icon:_common.default.icon,text:widgetNameTitle,onAction:defaultAction}),function(editor){editor.on("init",(()=>{const jQuery=_container.DIContainer.get("jQuery"),subversion=1,allCss=`${cfg.wwwroot}/theme/styles.php/${cfg.theme}/${cfg.themerev}_${subversion}/all`;editor.dom.loadCSS(allCss);const jQueryVersion=jQuery.fn.jquery??"3.6.1",scriptJQ=editor.dom.create("script",{src:`https://code.jquery.com/jquery-${jQueryVersion}.min.js`}),head=editor.getDoc().querySelector("head");scriptJQ.onload=()=>{var _jQuery$fn$tooltip,_jQuery$fn$tooltip$Co;const bsVersion=(null===(_jQuery$fn$tooltip=jQuery.fn.tooltip)||void 0===_jQuery$fn$tooltip||null===(_jQuery$fn$tooltip$Co=_jQuery$fn$tooltip.Constructor)||void 0===_jQuery$fn$tooltip$Co?void 0:_jQuery$fn$tooltip$Co.VERSION)??"4.6.2",scriptBS=editor.dom.create("script",{src:`https://cdn.jsdelivr.net/npm/bootstrap@${bsVersion}/dist/js/bootstrap.bundle.min.js`});head.appendChild(scriptBS),scriptBS.onload=()=>{const scriptInitBS=editor.dom.create("script");scriptInitBS.innerHTML="\n                $(document).ready(function() {\n                    $('body').tooltip({\n                        selector: '[data-toggle=\"tooltip\"]',\n                        trigger: 'hover'\n                    });\n                    $('body').popover({\n                        selector: '[data-toggle=\"popover\"]',\n                        trigger: 'hover'\n                    });\n                });",head.appendChild(scriptInitBS)},(0,_contextInit.initContextActions)(editor)},head.appendChild(scriptJQ);const adminCss=(0,_options.getAdditionalCss)(editor)||"";adminCss.trim()&&editor.dom.addStyle(adminCss)}))}(editor)}};class FileSrv{constructor(editor){this.editor=editor}getImagePicker(){return(0,_options2.getFilePicker)(this.editor,"image")}displayImagePicker(){return(0,_utils.displayFilepicker)(this.editor,"image")}}let _ejs;_exports.FileSrv=FileSrv;const ejsLoader=()=>_ejs?Promise.resolve(_ejs):new Promise(((resolve,reject)=>{window.require(["tiny_widgethub/ejs-lazy"],(ejsModule=>{_ejs=ejsModule,_ejs?resolve(_ejs):reject()}),reject)}));_exports.ejsLoader=ejsLoader,_container.DIContainer.registerSingleton("jQuery",_jquery.default),_container.DIContainer.registerSingleton("coreStr",coreStr),_container.DIContainer.registerSingleton("modalSrv",_modalSrv.ModalSrv),_container.DIContainer.registerSingleton("mustache",_mustache.default),_container.DIContainer.registerSingleton("ejsLoader",ejsLoader),_container.DIContainer.registerSingleton("iStorage",{localStorage:localStorage,sessionStorage:sessionStorage}),_container.DIContainer.registerSingleton("domSrv",_domSrv.DomSrv,"jQuery"),_container.DIContainer.registerSingleton("templateSrv",_templateSrv.TemplateSrv,"mustache, ejsLoader"),_container.DIContainer.registerSingleton("userStorage",_userStorageSrv.UserStorageSrv,"editorOptions, iStorage"),_container.DIContainer.registerSingleton("applyWidgetFilter",_util.applyWidgetFilterFactory,"editor, coreStr"),_container.DIContainer.registerFactory("widgetParamsFactory",_widgetParamsCtrl.WidgetParamsCtrl,"editor, userStorage, templateSrv, modalSrv, formCtrl"),_container.DIContainer.registerService("editorOptions",_options.EditorOptions,"editor"),_container.DIContainer.registerService("widgetPickCtrl",_widgetPickerCtrl.WidgetPickerCtrl,"editor, editorOptions, widgetParamsFactory, modalSrv, templateSrv, userStorage"),_container.DIContainer.registerService("widgetPropertiesCtrl",_widgetPropertiesCtrl.default,"editor, formCtrl, modalSrv"),_container.DIContainer.registerService("formCtrl",_formCtrl.FormCtrl,"editor, userStorage, templateSrv, fileSrv, jQuery"),_container.DIContainer.registerService("fileSrv",FileSrv,"editor")}));

//# sourceMappingURL=commands.min.js.map