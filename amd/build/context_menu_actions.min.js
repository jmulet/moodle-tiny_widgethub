define("tiny_widgethub/context_menu_actions",["exports","jquery","./options","./util","./context_menu_editor","editor_tiny/utils"],(function(_exports,_jquery,_options,_util,_context_menu_editor,_utils){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function moveBefore($e){const prev=$e.prev();prev.length&&$e.insertBefore(prev)}function moveAfter($e){const next=$e.next();next.length&&$e.insertAfter(next)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_exports.moveAfter=moveAfter,_jquery=_interopRequireDefault(_jquery),_context_menu_editor=_interopRequireDefault(_context_menu_editor);var _default={"@edit":function(evt){new _context_menu_editor.default(this).show(evt)},"@unpack":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem);if(""===this.currentContext.snpt.unpack)$target.removeClass();else{const toUnpack=$target.find(this.currentContext.snpt.unpack+"");toUnpack.first().removeClass("iedib-inspoint iedib-iq"),$target.replaceWith(toUnpack)}this.uiContextMenu.hide()},"@clipboard/cut":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),$parent=$target.parent(),$sibling=$target.next();let siblingHTML="";$sibling.find(".iedib-caption-title").length&&($sibling.css("text-align","center"),siblingHTML=" "+$sibling.prop("outerHTML"),console.log("Adding sibling HTML ",siblingHTML),$sibling.detach()),$target.detach(),0===$parent.children().length&&$parent.remove();const content=this.currentContext.snpt.name+" @@ "+$target.prop("outerHTML")+siblingHTML;try{this.clipBoard.push(content);const userid=(0,_options.getUserId)(this.editor);localStorage.setItem("widgethub-clipboard_"+userid,JSON.stringify(this.clipBoard))}catch(ex){console.error(ex)}this.uiContextMenu.hide()},"@clipboard/paste":function(evt){evt.preventDefault(),this.uiContextMenu.hide();const indx=(0,_util.convertInt)(evt.currentTarget.dataset.indx,0),clipBoardQueue=this.clipBoard;if(clipBoardQueue.length>0&&indx<clipBoardQueue.length){const toPaste=this.clipBoard[indx].replace(/^.*@@/,"");this.editor.selection.setContent(toPaste);try{clipBoardQueue.splice(indx,1);const userid=(0,_options.getUserId)(this.editor);localStorage.setItem("widgethub-clipboard_"+userid,JSON.stringify(this.clipBoard))}catch(ex){console.error(ex)}}},"@clipboard/clear":function(evt){evt.preventDefault(),this.uiContextMenu.hide();try{const userid=(0,_options.getUserId)(this.editor);this.clipBoard=[],localStorage.setItem("widgethub-clipboard_"+userid,"[]")}catch(ex){console.error(ex)}},"tabs/add":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),$allLI=$target.find("ul.nav.nav-tabs > li"),$lst=$allLI.last().clone(),href=$lst.find("a").attr("href")||"",$panel=$target.find(href).clone(),newId="ed"+Math.random().toString(32).substring(2);$panel.html("<p>Edita el contingut "+newId+".</p>"),$panel.attr("id",newId),$panel.removeClass("active");const theA=$lst.find("a");if(theA.attr("href","#"+newId),theA.removeClass("active"),theA.html("<span>&nbsp;Tab"+($allLI.length+1)+"</span>"),this.currentContext.theTab){const $theTab=(0,_jquery.default)(this.currentContext.theTab),referencePanel=$target.find($theTab.attr("href")||"");evt.currentTarget.dataset.before?($lst.insertBefore($theTab.parent()),$panel.insertBefore(referencePanel)):($lst.insertAfter($theTab.parent()),$panel.insertAfter(referencePanel))}else $target.find("ul.nav.nav-tabs").append($lst),$target.find("div.tab-content").append($panel);this.uiContextMenu.hide()},"tabs/move":function(evt){if(evt.preventDefault(),null==this.currentContext.theTab)return void this.uiContextMenu.hide();const $target=(0,_jquery.default)(this.currentContext.elem),href=this.currentContext.theTab.getAttribute("href")||"",$panel=$target.find(href),$li=(0,_jquery.default)(this.currentContext.theTab).parent();evt.currentTarget.dataset.before?(moveBefore($li),moveBefore($panel)):(moveAfter($li),moveAfter($panel)),this.uiContextMenu.hide()},"tabs/del":function(evt){if(evt.preventDefault(),null==this.currentContext.theTab)return void this.uiContextMenu.hide();const $target=(0,_jquery.default)(this.currentContext.elem);if(1===$target.find("ul.nav.nav-tabs > li").length)$target.remove();else{const href=this.currentContext.theTab.getAttribute("href")||"";$target.find(href).remove();const theLi=this.currentContext.theTab.parentElement;theLi&&(0,_jquery.default)(theLi).remove(),$target.find("ul.nav.nav-tabs > li > a").first().trigger("click")}this.uiContextMenu.hide()},imatge:function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),which=evt.currentTarget.dataset.effect;which?$target.attr("data-snptd",which):$target.removeAttr("data-snptd"),this.uiContextMenu.hide()},"imatge-fons":function(evt){evt.preventDefault(),this.uiContextMenu.hide();const $target=(0,_jquery.default)(this.currentContext.elem);(0,_utils.displayFilepicker)(this.editor,"image").then((params=>{null!=params&&params.url&&$target.css("background-image","url('"+params.url+"')")})).catch()},"two-cols":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem);if("rm"===evt.currentTarget.dataset.cols){const columns=$target.find("div");columns.removeClass(),$target.replaceWith(columns)}else{const colSpan=(0,_util.convertInt)(evt.currentTarget.dataset.cols,0),first=$target.find("div:first-child"),last=$target.find("div:last-child");first.removeClass(),last.removeClass(),first.addClass("span"+colSpan),last.addClass("span"+(12-colSpan))}this.uiContextMenu.hide()},desplegable2:function(evt){if(evt.preventDefault(),null==this.currentContext.theTab)return console.error("theTab is null"),void this.uiContextMenu.hide();const $target=(0,_jquery.default)(this.currentContext.elem),$group=(0,_jquery.default)(this.currentContext.theTab),opt=evt.currentTarget.dataset.accordion;if("rm"===opt)$group.remove(),0===$target.find("div.accordion-group").length&&$target.remove();else if("iup"===opt){const $cloneGroup=$target.find("div.accordion-group:first-child").clone(),newId="nid_"+Math.random().toString(32).substring(2);$cloneGroup.find("a.accordion-toggle").attr("href","#"+newId),$cloneGroup.find("div.accordion-body").attr("id",newId),$cloneGroup.find("div.accordion-body > .accordion-inner").html("<p>Editar contingut</p>"),$cloneGroup.insertBefore($group)}else if("idwn"===opt){const $cloneGroup2=$target.find("div.accordion-group:first-child").clone(),newId2="nid_"+Math.random().toString(32).substring(2);$cloneGroup2.find("a.accordion-toggle").attr("href","#"+newId2),$cloneGroup2.find("div.accordion-body").attr("id",newId2),$cloneGroup2.find("div.accordion-body > .accordion-inner").html("<p>Editar contingut</p>"),$cloneGroup2.insertAfter($group)}else if("2list"===opt){const listSubstitute=(0,_jquery.default)("<ul></ul>");$target.find("a.accordion-toggle").each(((i,a)=>{const $e=$target.find(a.getAttribute("href")||"");$e.detach(),$e.removeClass();const theLi=(0,_jquery.default)("<li></li>");theLi.append(a.innerHTML),theLi.append($e),listSubstitute.append(theLi)})),$target.replaceWith(listSubstitute)}else if("mup"===opt)moveBefore($group);else if("mdwn"===opt)moveAfter($group);else if("bind"===opt)$target.find("div.accordion-body").removeAttr("data-parent");else if("bacc"===opt){const acid=$target.attr("id");$target.find("div.accordion-body").attr("data-parent","#"+acid)}this.uiContextMenu.hide()},"taula-predefinida":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),act=evt.currentTarget.dataset.pos;if("2bs"===act)$target.removeClass("iedib-table"),$target.addClass("table table-striped iedib-bstable"),$target.find("td,th").removeAttr("style"),$target.find("thead > tr > th").attr("role","col");else if("2pf"===act)$target.removeClass("table table-bordered table-hover table-striped table-responsive iedib-bstable"),$target.addClass("iedib-table"),$target.attr("style","table-layout:fixed; border-collapse:collapse; border-spacing:0px; width:96%;"),$target.find("td,th").css("border","1px solid gray");else if("thead"===act){let head=$target.find("thead");if(head.length)head.remove();else{head=(0,_jquery.default)("<thead></thead>");const tr=(0,_jquery.default)("<tr></tr>");$target.find("tr").first().find("td").each((function(){const newTh=(0,_jquery.default)('<th role="col">Títol</th>'),st=(0,_jquery.default)(this).attr("style");newTh.attr("style",st||""),tr.append(newTh)})),head.append(tr),$target.prepend(head)}}else if("tfoot"===act){let foot=$target.find("tfoot");if(foot.length)foot.remove();else{foot=(0,_jquery.default)("<tfoot></tfoot>");const tr2=(0,_jquery.default)("<tr></tr>");$target.find("tbody tr").first().find("td").each((function(){const newTd=(0,_jquery.default)("<td>Resum</td>"),st=(0,_jquery.default)(this).attr("style");newTd.attr("style",st||""),tr2.append(newTd)})),foot.append(tr2),$target.append(foot)}}else if("delres"===act)$target.parent().replaceWith($target);else if("addres"===act){const $div=(0,_jquery.default)('<div class="table-responsive"></div>');$target.replaceWith($div),$div.append((0,_jquery.default)(this.currentContext.elem))}this.uiContextMenu.hide()},"taula-predefinida/maxwidth":function(evt){const $target=(0,_jquery.default)(this.currentContext.elem),maxwidth=(0,_util.convertInt)(evt.currentTarget.dataset.value,0);maxwidth>0?$target.css("max-width",maxwidth+"px"):$target.css("max-width","")},capsa:function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem);let newLang=evt.currentTarget.dataset.lang||"ca";const newType=evt.currentTarget.dataset.type,isTascaExercici="true"===evt.currentTarget.dataset.proposat;console.log(isTascaExercici,this.currentContext.elem);let $lateral,widgetKey=this.currentContext.snpt.key;if(newType&&($target.removeClass("iedib-alerta-border iedib-important-border iedib-consell-border iedib-introduccio-border iedib-ampliacio-border"),$target.addClass("iedib-"+newType+"-border"),$lateral=$target.find(".iedib-lateral"),$lateral.removeClass("iedib-alerta iedib-important iedib-consell iedib-introduccio iedib-ampliacio"),$lateral.addClass("iedib-"+newType),newLang=$target.attr("data-lang")||"ca"),newLang){$lateral=$target.find("div.iedib-lateral > p.iedib-titolLateral");const theType=newType||evt.currentTarget.dataset.oldtype;$target.attr("data-lang",newLang),isTascaExercici&&(widgetKey="tasca-exercici");const widget=this.currentContext.snpt;if(null!=widget){const I18n=widget.I18n;let langKey="capsa-generica"===widgetKey?"msg_"+theType:"msg";if(isTascaExercici&&(langKey="msg_epr"),I18n&&I18n[langKey]&&I18n[langKey][newLang])if(isTascaExercici){$target.find(".iedib-central h4").first().html(I18n[langKey][newLang])}else $lateral.html(I18n[langKey][newLang]),$lateral.append('<span class="iedib-'+theType+'-logo"></span>')}}this.uiContextMenu.hide()},"capsa/mida":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem);$target.removeClass("iedib-capsa-petita iedib-capsa-mitjana iedib-capsa-gran"),$target.addClass("iedib-capsa-"+evt.currentTarget.dataset.mida),this.uiContextMenu.hide()},"capsa-exemple-cols":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),lang=$target.attr("data-lang")||"ca",lateral=$target.find("p.iedib-titolLateral").html(),formulacio=$target.find("div.span4.iedib-formulacio > *"),resolucio=$target.find("div.span8.iedib-resolucio > div.iedib-central > *"),newSnpt=(0,_jquery.default)('<div class="iedib-capsa iedib-capsa-gran iedib-exemple-border" data-lang="'+lang+'"><div class="iedib-lateral iedib-exemple"><p class="iedib-titolLateral">'+lateral+'</p></div><div class="iedib-formulacio-rows"></div><div class="iedib-resolucio-rows"></div></div>');newSnpt.find("div.iedib-formulacio-rows").append(formulacio),newSnpt.find("div.iedib-resolucio-rows").append(resolucio),$target.replaceWith(newSnpt),this.uiContextMenu.hide()},"capsa-exemple-rows":function(evt){var _this$currentContext$;evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),lang=$target.attr("data-lang")||"ca",solLabel=((null===(_this$currentContext$=this.currentContext.snpt.I18n)||void 0===_this$currentContext$?void 0:_this$currentContext$.sol)||{})[lang]||"Solució",formulacio=$target.find("div.iedib-formulacio-rows > *").clone(),resolucio=$target.find("div.iedib-resolucio-rows >  *").clone(),lateral=$target.find("p.iedib-titolLateral").html(),newSnpt=(0,_jquery.default)('<div class="iedib-capsa iedib-capsa-gran iedib-exemple-border" data-lang="'+lang+'"><div class="iedib-lateral iedib-exemple"><p class="iedib-titolLateral">'+lateral+'</span></p></div><div class="iedib-central"><br></div></div>');console.log(resolucio);const central=newSnpt.find("div.iedib-central");central.append(formulacio),0===resolucio.find("div.accordion").length&&central.append("<p><b>"+solLabel+"</b>:</p>"),central.append(resolucio),$target.replaceWith(newSnpt),this.uiContextMenu.hide()},"!ol":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),opt=evt.currentTarget.dataset.ol;if("snorm"===opt)$target.removeClass("iedib-falist"),this.uiContextMenu.hide();else if("sfa"===opt){$target.addClass("iedib-falist");const startAt=$target.attr("start")||"1";if(null!=startAt){const beginAt=parseInt(startAt);$target.css("counter-reset","iedibfalist-counter "+(beginAt-1))}else $target.css("counter-reset","");this.uiContextMenu.hide()}else if("startAt"===opt){const startAt2=evt.currentTarget.dataset.value||"1";if(startAt2){const beginAt3=parseInt(startAt2);$target.attr("start",beginAt3),$target.css("counter-reset","iedibfalist-counter "+(beginAt3-1))}}},"!img":function(evt){evt.preventDefault();const $target=(0,_jquery.default)(this.currentContext.elem),$snpt=(0,_jquery.default)('<div class="iedib-figura iedib-grid-responsive"></div');$snpt.append($target.clone()),$snpt.append((0,_jquery.default)('<p class="iedib-img-footer"><span class="iedib-caption-counter">Imatge:</span> <span class="iedib-caption-title">Descripció</span></p>')),$target.replaceWith($snpt),this.uiContextMenu.hide()}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=context_menu_actions.min.js.map