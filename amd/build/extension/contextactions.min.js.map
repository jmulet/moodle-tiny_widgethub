{"version":3,"file":"contextactions.min.js","sources":["../../src/extension/contextactions.js"],"sourcesContent":["/* eslint-disable no-console */\nimport {addRequires, cleanUnusedRequires} from './dependencies';\nimport jQuery from 'jquery';\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} type\n * @returns {() => void}\n */\nexport function addImageEffectAction(ctx, type) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.attr(\"data-snptd\", type);\n        addRequires(ctx.editor, [\"/sd/images.min.js\"]);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void}\n */\nexport function removeImageEffectsAction(ctx) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.removeAttr(\"data-snptd\");\n        cleanUnusedRequires(ctx.editor);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} iso\n * @returns {() => void} The action to execute\n */\nexport function changeBoxLangAction(ctx, iso) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        const $lateral = elem.find('.iedib-titolLateral');\n        const isTascaExercici = elem.attr('data-proposat') === 'true' ||\n                elem.find('.iedib-tasca.iedib-central').length > 0;\n\n        let theType;\n        let langKey = \"msg\";\n        if (isTascaExercici) {\n            if (elem.find('.iedib-tasca.iedib-proposat').length) {\n                langKey = \"msg_epr\";\n            } else {\n                // TODO: Must see if it is tava or tapr\n                langKey = \"msg_tapr\";\n            }\n        } else {\n            [\"alerta\", \"ampliacio\", \"consell\", \"important\", \"introduccio\"].forEach((ty) => {\n                if (elem.hasClass(\"iedib-\" + ty + \"-border\")) {\n                    theType = ty;\n                }\n            });\n            langKey = \"msg_\" + theType;\n        }\n        console.log(\"Changing language\", langKey, iso);\n        const I18n = widget.I18n;\n        if (I18n?.[langKey]?.[iso]) {\n            if (isTascaExercici) {\n                const h4 = elem.find('.iedib-central h4').first();\n                h4.html(I18n[langKey][iso]);\n            } else {\n                $lateral.html(I18n[langKey][iso]);\n                $lateral.append('<span class=\"iedib-' + theType + '-logo\"></span>');\n            }\n        }\n        // Replace data-lang\n        elem.attr('data-lang', iso);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} size\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSizeAction(ctx, size) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\"iedib-capsa-petita iedib-capsa-mitjana iedib-capsa-gran\");\n        elem.addClass(\"iedib-capsa-\" + size);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} severity\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSeverityAction(ctx, severity) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\n            \"iedib-alerta-border iedib-important-border iedib-consell-border iedib-introduccio-border iedib-ampliacio-border\");\n        elem.addClass(\"iedib-\" + severity + \"-border\");\n        const $lateral = elem.find(\".iedib-lateral\");\n        $lateral.removeClass(\"iedib-alerta iedib-important iedib-consell iedib-introduccio iedib-ampliacio\");\n        $lateral.addClass(\"iedib-\" + severity);\n        const lang = elem.attr(\"data-lang\") || \"ca\";\n        let langKey = \"msg_\" + severity;\n        // Change the lateral title\n        if (widget.I18n?.[langKey]?.[lang]) {\n            $lateral.find('.iedib-titolLateral')\n                .html(widget.I18n[langKey][lang]);\n        }\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxSimpleExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!$target || !widget) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const solLabel = widget.I18n?.sol?.[lang] ?? 'Solució';\n        const formulacio = $target.find(\"div.iedib-formulacio-rows > *\").clone();\n        const resolucio = $target.find(\"div.iedib-resolucio-rows >  *\").clone();\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</span></p>' +\n            '</div>' +\n            '<div class=\"iedib-central\">' +\n            // Formulacio\n            // Resolució\n            '<br></div></div>');\n        const central = newSnpt.find('div.iedib-central');\n        central.append(formulacio);\n        if (resolucio.find('div.accordion').length === 0) {\n            central.append(\"<p><b>\" + solLabel + \"</b>:</p>\");\n        }\n        central.append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxRowsExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        if (!$target) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const formulacio = $target.find(\"div.span4.iedib-formulacio > *\");\n        const resolucio = $target.find(\"div.span8.iedib-resolucio > div.iedib-central > *\");\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</p>' +\n            '</div>' +\n            '<div class=\"iedib-formulacio-rows\">' +\n            // Add formulació\n            '</div>' +\n            '<div class=\"iedib-resolucio-rows\">' +\n            // Add resolució\n            '</div></div>');\n\n        newSnpt.find('div.iedib-formulacio-rows').append(formulacio);\n        newSnpt.find('div.iedib-resolucio-rows').append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function imageSwitchToSnippetAction(ctx) {\n    return () => {\n        // eslint-disable-next-line no-console\n        console.log('imageSwitchToSnippetAction');\n        const $target = ctx.path?.targetElement;\n        if (!$target) {\n            return;\n        }\n        const $snpt = jQuery('<div class=\"iedib-figura iedib-grid-responsive\"></div');\n        $snpt.append($target.clone());\n        // eslint-disable-next-line max-len\n        $snpt.append(jQuery('<p class=\"iedib-img-footer\"><span class=\"iedib-caption-counter\">Imatge:</span> <span class=\"iedib-caption-title\">Descripció</span></p>'));\n        $target.replaceWith($snpt);\n    };\n}\n\n"],"names":["ctx","type","elem","path","_ctx$path","attr","editor","iso","_ctx$path3","widget","_ctx$path4","$lateral","find","isTascaExercici","length","theType","langKey","forEach","ty","hasClass","console","log","I18n","_I18n$langKey","first","html","append","severity","_ctx$path7","_ctx$path8","removeClass","addClass","lang","_widget$I18n","_widget$I18n$langKey","size","_ctx$path5","_ctx$path6","$target","_ctx$path12","targetElement","$snpt","clone","replaceWith","_ctx$path2","removeAttr","_ctx$path11","lateral","formulacio","resolucio","newSnpt","_ctx$path9","_ctx$path10","solLabel","sol","central"],"mappings":"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"}