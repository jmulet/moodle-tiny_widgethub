{"version":3,"file":"contextactions.min.js","sources":["../../src/extension/contextactions.js"],"sourcesContent":["/* eslint-disable no-console */\nimport {addRequires, cleanUnusedRequires} from './dependencies';\nimport jQuery from 'jquery';\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} type\n * @returns {() => void}\n */\nexport function addImageEffectAction(ctx, type) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.attr(\"data-snptd\", type);\n        addRequires(ctx.editor, [\"/sd/images.min.js\"]);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void}\n */\nexport function removeImageEffectsAction(ctx) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.removeAttr(\"data-snptd\");\n        cleanUnusedRequires(ctx.editor);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} iso\n * @returns {() => void} The action to execute\n */\nexport function changeBoxLangAction(ctx, iso) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        const $lateral = elem.find('.iedib-titolLateral');\n        const isTascaExercici = elem.attr('data-proposat') !== undefined ||\n                elem.find('.iedib-tasca.iedib-central').length > 0;\n\n        let theType;\n        let langKey = \"msg\";\n        if (isTascaExercici) {\n            if (elem.find('.iedib-tasca.iedib-proposat').length) {\n                langKey = \"msg_epr\";\n            } else {\n                // Must see if it is tava or tapr\n                langKey = \"msg_\" + (elem.attr('data-proposat') ?? \"tapr\");\n            }\n        } else if (widget.key === 'capsa-generica') {\n            [\"alerta\", \"ampliacio\", \"consell\", \"important\", \"introduccio\"].forEach((ty) => {\n                if (elem.hasClass(\"iedib-\" + ty + \"-border\")) {\n                    theType = ty;\n                }\n            });\n            langKey = \"msg_\" + theType;\n        }\n        console.log(\"Changing language\", langKey, iso);\n        const I18n = widget.I18n;\n        if (I18n?.[langKey]?.[iso]) {\n            if (isTascaExercici) {\n                const h4 = elem.find('.iedib-central h4').first();\n                h4.html(I18n[langKey][iso] + \":\");\n            } else {\n                $lateral.html(I18n[langKey][iso]);\n                $lateral.append('<span class=\"iedib-' + theType + '-logo\"></span>');\n            }\n        }\n        // Replace data-lang\n        elem.attr('data-lang', iso);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} size\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSizeAction(ctx, size) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\"iedib-capsa-petita iedib-capsa-mitjana iedib-capsa-gran\");\n        elem.addClass(\"iedib-capsa-\" + size);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} severity\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSeverityAction(ctx, severity) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\n            \"iedib-alerta-border iedib-important-border iedib-consell-border iedib-introduccio-border iedib-ampliacio-border\");\n        elem.addClass(\"iedib-\" + severity + \"-border\");\n        const $lateral = elem.find(\".iedib-lateral\");\n        $lateral.removeClass(\"iedib-alerta iedib-important iedib-consell iedib-introduccio iedib-ampliacio\");\n        $lateral.addClass(\"iedib-\" + severity);\n        const lang = elem.attr(\"data-lang\") || \"ca\";\n        let langKey = \"msg_\" + severity;\n        // Change the lateral title\n        if (widget.I18n?.[langKey]?.[lang]) {\n            $lateral.find('.iedib-titolLateral')\n                .html(widget.I18n[langKey][lang]);\n        }\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxSimpleExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!$target || !widget) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const solLabel = widget.I18n?.sol?.[lang] ?? 'Solució';\n        const formulacio = $target.find(\"div.iedib-formulacio-rows > *\").clone();\n        const resolucio = $target.find(\"div.iedib-resolucio-rows >  *\").clone();\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</span></p>' +\n            '</div>' +\n            '<div class=\"iedib-central\">' +\n            // Formulacio\n            // Resolució\n            '<br></div></div>');\n        const central = newSnpt.find('div.iedib-central');\n        central.append(formulacio);\n        if (resolucio.find('div.accordion').length === 0) {\n            central.append(\"<p><b>\" + solLabel + \"</b>:</p>\");\n        }\n        central.append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxRowsExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        if (!$target) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const formulacio = $target.find(\"div.span4.iedib-formulacio > *\");\n        const resolucio = $target.find(\"div.span8.iedib-resolucio > div.iedib-central > *\");\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</p>' +\n            '</div>' +\n            '<div class=\"iedib-formulacio-rows\">' +\n            // Add formulació\n            '</div>' +\n            '<div class=\"iedib-resolucio-rows\">' +\n            // Add resolució\n            '</div></div>');\n\n        newSnpt.find('div.iedib-formulacio-rows').append(formulacio);\n        newSnpt.find('div.iedib-resolucio-rows').append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function imageSwitchToSnippetAction(ctx) {\n    return () => {\n        // eslint-disable-next-line no-console\n        console.log('imageSwitchToSnippetAction');\n        const $target = ctx.path?.targetElement;\n        if (!$target) {\n            return;\n        }\n        const $snpt = jQuery('<div class=\"iedib-figura iedib-grid-responsive\"></div');\n        $snpt.append($target.clone());\n        // eslint-disable-next-line max-len\n        $snpt.append(jQuery('<p class=\"iedib-img-footer\"><span class=\"iedib-caption-counter\">Imatge:</span> <span class=\"iedib-caption-title\">Descripció</span></p>'));\n        $target.replaceWith($snpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {number} colSpan\n * @returns {() => void} The action to execute\n */\nexport function changeColumnWidth(ctx, colSpan) {\n    return () => {\n        const $target = ctx.path?.elem;\n        if (!$target) {\n            return;\n        }\n        if (colSpan <= 0 || colSpan > 12) {\n            // Set to one column flow\n            const columns = $target.find(\"div\");\n            columns.removeClass();\n            $target.replaceWith(columns);\n        } else {\n            // Define the spans\n            const first = $target.find(\"div:first-child\");\n            const last = $target.find(\"div:last-child\");\n            first.removeClass();\n            last.removeClass();\n            first.addClass(\"span\" + colSpan);\n            last.addClass(\"span\" + (12 - colSpan));\n        }\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {boolean} isDependentBehavior\n * @returns {() => void} The action to execute\n */\nexport function setAccordionBehavior(ctx, isDependentBehavior) {\n    return () => {\n        const $target = ctx.path?.elem;\n        if (!$target) {\n            return;\n        }\n        if (isDependentBehavior) {\n            // Behavior individual\n            $target.find(\"div.accordion-body\").removeAttr(\"data-parent\");\n        } else {\n            // Behavior accordion\n            const acid = $target.attr(\"id\");\n            $target.find(\"div.accordion-body\").attr(\"data-parent\", \"#\" + acid);\n        }\n    };\n}"],"names":["ctx","type","elem","path","_ctx$path","attr","editor","iso","_ctx$path3","widget","_ctx$path4","$lateral","find","isTascaExercici","undefined","length","theType","langKey","key","forEach","ty","hasClass","console","log","I18n","_I18n$langKey","first","html","append","severity","_ctx$path7","_ctx$path8","removeClass","addClass","lang","_widget$I18n","_widget$I18n$langKey","size","_ctx$path5","_ctx$path6","colSpan","$target","_ctx$path13","columns","replaceWith","last","_ctx$path12","targetElement","$snpt","clone","_ctx$path2","removeAttr","isDependentBehavior","_ctx$path14","acid","_ctx$path11","lateral","formulacio","resolucio","newSnpt","_ctx$path9","_ctx$path10","solLabel","sol","central"],"mappings":"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"}