{"version":3,"file":"contextactions.min.js","sources":["../../src/extension/contextactions.js"],"sourcesContent":["import {addRequires, cleanUnusedRequires} from './dependencies';\nimport jQuery from 'jquery';\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} type\n * @returns {() => void}\n */\nexport function addImageEffectAction(ctx, type) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.attr(\"data-snptd\", type);\n        addRequires(ctx.editor, [\"/sd/images.min.js\"]);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void}\n */\nexport function removeImageEffectsAction(ctx) {\n    return () => {\n        const elem = ctx.path?.elem;\n        if (!elem) {\n            return;\n        }\n        elem.removeAttr(\"data-snptd\");\n        cleanUnusedRequires(ctx.editor);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} iso\n * @returns {() => void} The action to execute\n */\nexport function changeBoxLangAction(ctx, iso) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        const $lateral = elem.find('.iedib-titolLateral');\n        let snippetKey = widget.key;\n        const isTascaExercici = elem.attr('data-proposat') === 'true';\n        let theType;\n        [\"alerta\", \"ampliacio\", \"consell\", \"important\", \"introduccio\"].forEach((ty) => {\n            if (elem.hasClass(\"iedib-\" + ty + \"-border\")) {\n                theType = ty;\n            }\n        });\n        if (isTascaExercici) {\n            snippetKey = 'tasca-exercici';\n        }\n        const I18n = widget.I18n;\n        let langKey = snippetKey === \"capsa-generica\" ? \"msg_\" + theType : \"msg\";\n        if (isTascaExercici) {\n            langKey = 'msg_epr';\n        }\n        if (I18n?.[langKey]?.[iso]) {\n            if (isTascaExercici) {\n                const h4 = elem.find('.iedib-central h4').first();\n                h4.html(I18n[langKey][iso]);\n            } else {\n                $lateral.html(I18n[langKey][iso]);\n                $lateral.append('<span class=\"iedib-' + theType + '-logo\"></span>');\n            }\n        }\n        // Replace data-lang\n        elem.attr('data-lang', iso);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} size\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSizeAction(ctx, size) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\"iedib-capsa-petita iedib-capsa-mitjana iedib-capsa-gran\");\n        elem.addClass(\"iedib-capsa-\" + size);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @param {string} severity\n * @returns {() => void} The action to execute\n */\nexport function changeBoxSeverityAction(ctx, severity) {\n    return () => {\n        const elem = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!elem || !widget) {\n            return;\n        }\n        elem.removeClass(\n            \"iedib-alerta-border iedib-important-border iedib-consell-border iedib-introduccio-border iedib-ampliacio-border\");\n        elem.addClass(\"iedib-\" + severity + \"-border\");\n        const $lateral = elem.find(\".iedib-lateral\");\n        $lateral.removeClass(\"iedib-alerta iedib-important iedib-consell iedib-introduccio iedib-ampliacio\");\n        $lateral.addClass(\"iedib-\" + severity);\n        const lang = elem.attr(\"data-lang\") || \"ca\";\n        let langKey = \"msg_\" + severity;\n        // Change the lateral title\n        if (widget.I18n?.[langKey]?.[lang]) {\n            $lateral.find('.iedib-titolLateral')\n                .html(widget.I18n[langKey][lang]);\n        }\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxSimpleExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        const widget = ctx.path?.widget;\n        if (!$target || !widget) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const solLabel = widget.I18n?.sol?.[lang] ?? 'Solució';\n        const formulacio = $target.find(\"div.iedib-formulacio-rows > *\").clone();\n        const resolucio = $target.find(\"div.iedib-resolucio-rows >  *\").clone();\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</span></p>' +\n            '</div>' +\n            '<div class=\"iedib-central\">' +\n            // Formulacio\n            // Resolució\n            '<br></div></div>');\n        const central = newSnpt.find('div.iedib-central');\n        central.append(formulacio);\n        if (resolucio.find('div.accordion').length === 0) {\n            central.append(\"<p><b>\" + solLabel + \"</b>:</p>\");\n        }\n        central.append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function switchBoxRowsExampleAction(ctx) {\n    return () => {\n        const $target = ctx.path?.elem;\n        if (!$target) {\n            return;\n        }\n        const lang = $target.attr(\"data-lang\") || \"ca\";\n        const lateral = $target.find(\"p.iedib-titolLateral\").html();\n        const formulacio = $target.find(\"div.span4.iedib-formulacio > *\");\n        const resolucio = $target.find(\"div.span8.iedib-resolucio > div.iedib-central > *\");\n        const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n            '<div class=\"iedib-lateral iedib-exemple\">' +\n            '<p class=\"iedib-titolLateral\">' + lateral + '</p>' +\n            '</div>' +\n            '<div class=\"iedib-formulacio-rows\">' +\n            // Add formulació\n            '</div>' +\n            '<div class=\"iedib-resolucio-rows\">' +\n            // Add resolució\n            '</div></div>');\n\n        newSnpt.find('div.iedib-formulacio-rows').append(formulacio);\n        newSnpt.find('div.iedib-resolucio-rows').append(resolucio);\n        $target.replaceWith(newSnpt);\n    };\n}\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {() => void} The action to execute\n */\nexport function imageSwitchToSnippetAction(ctx) {\n    return () => {\n        // eslint-disable-next-line no-console\n        console.log('imageSwitchToSnippetAction');\n        const $target = ctx.path?.targetElement;\n        if (!$target) {\n            return;\n        }\n        const $snpt = jQuery('<div class=\"iedib-figura iedib-grid-responsive\"></div');\n        $snpt.append($target.clone());\n        // eslint-disable-next-line max-len\n        $snpt.append(jQuery('<p class=\"iedib-img-footer\"><span class=\"iedib-caption-counter\">Imatge:</span> <span class=\"iedib-caption-title\">Descripció</span></p>'));\n        $target.replaceWith($snpt);\n    };\n}\n\n"],"names":["ctx","type","elem","path","_ctx$path","attr","editor","iso","_ctx$path3","widget","_ctx$path4","$lateral","find","snippetKey","key","isTascaExercici","theType","forEach","ty","hasClass","I18n","langKey","_I18n$langKey","first","html","append","severity","_ctx$path7","_ctx$path8","removeClass","addClass","lang","_widget$I18n","_widget$I18n$langKey","size","_ctx$path5","_ctx$path6","console","log","$target","_ctx$path12","targetElement","$snpt","clone","replaceWith","_ctx$path2","removeAttr","_ctx$path11","lateral","formulacio","resolucio","newSnpt","_ctx$path9","_ctx$path10","solLabel","sol","central","length"],"mappings":"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"}