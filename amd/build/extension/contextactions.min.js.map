{"version":3,"file":"contextactions.min.js","sources":["../../src/extension/contextactions.js"],"sourcesContent":["\nimport {addRequires, cleanUnusedRequires} from './dependencies';\nimport jQuery from 'jquery';\n\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, type: string}}}\n */\nexport function addImageEffectAction() {\n    const ctx = this.ctx;\n    const type = this.type;\n    const elem = ctx.path?.elem;\n    if (!elem) {\n            return;\n    }\n    elem.attr(\"data-snptd\", type);\n    addRequires(ctx.editor, [\"/sd/images.min.js\"]);\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}}\n */\nexport function removeImageEffectsAction() {\n    const ctx = this.ctx;\n    const elem = ctx.path?.elem;\n    if (!elem) {\n        return;\n    }\n    elem.removeAttr(\"data-snptd\");\n    if (elem.attr(\"role\")?.startsWith(\"snptd_\")) {\n        elem.removeAttr(\"role\");\n    }\n    cleanUnusedRequires(ctx.editor);\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, iso: string}}\n */\nexport function changeBoxLangAction() {\n    const iso = this.iso;\n    const elem = this.ctx.path?.elem;\n    const widget = this.ctx.path?.widget;\n    if (!elem || !widget) {\n        return;\n    }\n    const $lateral = elem.find('.iedib-titolLateral');\n    const isTascaExercici = elem.attr('data-proposat') !== undefined ||\n        elem.find('.iedib-tasca.iedib-central').length > 0;\n\n    let theType;\n    let langKey = \"msg\";\n    if (isTascaExercici) {\n        if (elem.find('.iedib-tasca.iedib-proposat').length) {\n            langKey = \"msg_epr\";\n        } else {\n            // Must see if it is tava or tapr\n            langKey = \"msg_\" + (elem.attr('data-proposat') ?? \"tapr\");\n        }\n    } else if (widget.key === 'capsa-generica') {\n        [\"alerta\", \"ampliacio\", \"consell\", \"important\", \"introduccio\"].forEach((ty) => {\n            if (elem.hasClass(\"iedib-\" + ty + \"-border\")) {\n                theType = ty;\n            }\n        });\n        langKey = \"msg_\" + theType;\n    }\n    const I18n = widget.I18n;\n    if (I18n?.[langKey]?.[iso]) {\n        if (isTascaExercici) {\n            const h4 = elem.find('.iedib-central h4').first();\n            h4.html(I18n[langKey][iso] + \":\");\n        } else {\n            $lateral.html(I18n[langKey][iso]);\n            $lateral.append('<span class=\"iedib-' + theType + '-logo\"></span>');\n        }\n    }\n    // Replace data-lang\n    elem.attr('data-lang', iso);\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, size: string}}\n */\nexport function changeBoxSizeAction() {\n    const elem = this.ctx.path?.elem;\n    const widget = this.ctx.path?.widget;\n    if (!elem || !widget) {\n        return;\n    }\n    elem.removeClass(\"iedib-capsa-petita iedib-capsa-mitjana iedib-capsa-gran\");\n    elem.addClass(\"iedib-capsa-\" + this.size);\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, severity: string}}\n */\nexport function changeBoxSeverityAction() {\n    const severity = this.severity;\n    const elem = this.ctx.path?.elem;\n    const widget = this.ctx.path?.widget;\n    if (!elem || !widget) {\n        return;\n    }\n    elem.removeClass(\n        \"iedib-alerta-border iedib-important-border iedib-consell-border iedib-introduccio-border iedib-ampliacio-border\");\n    elem.addClass(\"iedib-\" + severity + \"-border\");\n    const $lateral = elem.find(\".iedib-lateral\");\n    $lateral.removeClass(\"iedib-alerta iedib-important iedib-consell iedib-introduccio iedib-ampliacio\");\n    $lateral.addClass(\"iedib-\" + severity);\n    const lang = elem.attr(\"data-lang\") || \"ca\";\n    let langKey = \"msg_\" + severity;\n    // Change the lateral title\n    if (widget.I18n?.[langKey]?.[lang]) {\n        $lateral.find('.iedib-titolLateral')\n            .html(widget.I18n[langKey][lang]);\n    }\n\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function switchBoxSimpleExampleAction() {\n    const $target = this.ctx.path?.elem;\n    const widget = this.ctx.path?.widget;\n    if (!$target || !widget) {\n        return;\n    }\n    const lang = $target.attr(\"data-lang\") || \"ca\";\n    const solLabel = widget.I18n?.sol?.[lang] ?? 'Solució';\n    const formulacio = $target.find(\"div.iedib-formulacio-rows > *\").clone();\n    const resolucio = $target.find(\"div.iedib-resolucio-rows >  *\").clone();\n    const lateral = $target.find(\"p.iedib-titolLateral\").html();\n    const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n        '<div class=\"iedib-lateral iedib-exemple\">' +\n        '<p class=\"iedib-titolLateral\">' + lateral + '</span></p>' +\n        '</div>' +\n        '<div class=\"iedib-central\">' +\n        // Formulacio\n        // Resolució\n        '<br></div></div>');\n    const central = newSnpt.find('div.iedib-central');\n    central.append(formulacio);\n    if (resolucio.find('div.accordion').length === 0) {\n        central.append(\"<p><b>\" + solLabel + \"</b>:</p>\");\n    }\n    central.append(resolucio);\n    $target.replaceWith(newSnpt);\n\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function switchBoxRowsExampleAction() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    const lang = $target.attr(\"data-lang\") || \"ca\";\n    const lateral = $target.find(\"p.iedib-titolLateral\").html();\n    const formulacio = $target.find(\"div.span4.iedib-formulacio > *\");\n    const resolucio = $target.find(\"div.span8.iedib-resolucio > div.iedib-central > *\");\n    const newSnpt = jQuery('<div class=\"iedib-capsa iedib-capsa-gran iedib-exemple-border\" data-lang=\"' + lang + '\">' +\n        '<div class=\"iedib-lateral iedib-exemple\">' +\n        '<p class=\"iedib-titolLateral\">' + lateral + '</p>' +\n        '</div>' +\n        '<div class=\"iedib-formulacio-rows\">' +\n        // Add formulació\n        '</div>' +\n        '<div class=\"iedib-resolucio-rows\">' +\n        // Add resolució\n        '</div></div>');\n\n    newSnpt.find('div.iedib-formulacio-rows').append(formulacio);\n    newSnpt.find('div.iedib-resolucio-rows').append(resolucio);\n    $target.replaceWith(newSnpt);\n\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function imageSwitchToSnippetAction() {\n    const $target = this.ctx.path?.targetElement;\n    if (!$target) {\n        return;\n    }\n    const $snpt = jQuery('<div class=\"iedib-figura iedib-grid-responsive\"></div');\n    $snpt.append($target.clone());\n    // eslint-disable-next-line max-len\n    $snpt.append(jQuery('<p class=\"iedib-img-footer\"><span class=\"iedib-caption-counter\">Imatge:</span> <span class=\"iedib-caption-title\">Descripció</span></p>'));\n    $target.replaceWith($snpt);\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, colSpan: number}}\n */\nexport function changeColumnWidth() {\n    const colSpan = this.colSpan;\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    if (colSpan <= 0 || colSpan > 12) {\n        // Set to one column flow\n        const columns = $target.find(\"div\");\n        columns.removeClass();\n        $target.replaceWith(columns);\n    } else {\n        // Define the spans\n        const first = $target.find(\"div:first-child\");\n        const last = $target.find(\"div:last-child\");\n        first.removeClass();\n        last.removeClass();\n        first.addClass(\"span\" + colSpan);\n        last.addClass(\"span\" + (12 - colSpan));\n    }\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext, isDependentBehavior: boolean}}\n */\nexport function setAccordionBehavior() {\n    const isDependentBehavior = this.isDependentBehavior;\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    if (isDependentBehavior) {\n        // Behavior individual\n        $target.find(\"div.accordion-body\").removeAttr(\"data-parent\");\n    } else {\n        // Behavior accordion\n        const acid = $target.attr(\"id\");\n        $target.find(\"div.accordion-body\").attr(\"data-parent\", \"#\" + acid);\n    }\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function convert2BootstrapTable() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    $target.removeClass(\"iedib-table\").removeAttr('style').removeAttr('border')\n           .addClass(\"table table-striped iedib-bstable\");\n    $target.find(\"td,th\").removeAttr(\"style\");\n    $target.find(\"thead > tr > th\").attr(\"role\", \"col\");\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function convert2PrefefinedTable() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    $target.removeClass(\"table table-bordered table-hover table-striped table-responsive iedib-bstable\");\n    $target.addClass(\"iedib-table\");\n    $target.attr(\"style\", 'table-layout:fixed; border-collapse:collapse; border-spacing:0px; width:96%;');\n    $target.find(\"td,th\").css(\"border\", '1px solid gray');\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function toggleTableHeader() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    let head = $target.find(\"thead\");\n    if (head.length) {\n        head.remove();\n    } else {\n        const jQuery = this.ctx.jQuery;\n        head = jQuery(\"<thead></thead>\");\n        const tr = jQuery(\"<tr></tr>\");\n        $target.find(\"tr\").first().find(\"td\").each(function() {\n            const newTh = jQuery('<th role=\"col\">Títol</th>');\n            const st = jQuery(this).attr(\"style\");\n            newTh.attr(\"style\", st ? st : \"\");\n            tr.append(newTh);\n        });\n        head.append(tr);\n        $target.prepend(head);\n    }\n}\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function toggleTableFooter() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n    let foot = $target.find(\"tfoot\");\n    if (foot.length) {\n        foot.remove();\n    } else {\n        const jQuery = this.ctx.jQuery;\n        foot = jQuery(\"<tfoot></tfoot>\");\n        const tr2 = jQuery(\"<tr></tr>\");\n        $target.find(\"tbody tr\").first().find(\"td\").each(\n        /**\n         * @this {HTMLElement}\n         */\n        function() {\n            const newTd = jQuery(\"<td>Resum</td>\");\n            const st = jQuery(this).attr(\"style\");\n            newTd.attr(\"style\", st ? st : \"\");\n            tr2.append(newTd);\n        });\n        foot.append(tr2);\n        $target.append(foot);\n    }\n}\n\n\n/**\n * @this {{ctx: import(\"../contextInit\").ItemMenuContext}}\n */\nexport function toggleBootstapTableResponsiveness() {\n    const $target = this.ctx.path?.elem;\n    if (!$target) {\n        return;\n    }\n\n    if ($target.parent().hasClass(\"table-responsive\")) {\n        // Delete responsiveness\n        $target.parent().replaceWith($target);\n    } else {\n        // Add responsiveness\n        const $div = this.ctx.jQuery('<div class=\"table-responsive\"></div>');\n        $target.replaceWith($div);\n        $div.append($target);\n    }\n}"],"names":["ctx","this","type","elem","path","_ctx$path","attr","editor","iso","_this$ctx$path","widget","_this$ctx$path2","$lateral","find","isTascaExercici","undefined","length","theType","langKey","key","forEach","ty","hasClass","I18n","_I18n$langKey","first","html","append","severity","_this$ctx$path5","_this$ctx$path6","removeClass","addClass","lang","_widget$I18n","_widget$I18n$langKey","_this$ctx$path3","_this$ctx$path4","size","colSpan","$target","_this$ctx$path11","columns","replaceWith","last","_this$ctx$path13","removeAttr","_this$ctx$path14","css","_this$ctx$path10","targetElement","$snpt","clone","_ctx$path2","_elem$attr","startsWith","isDependentBehavior","_this$ctx$path12","acid","_this$ctx$path9","lateral","formulacio","resolucio","newSnpt","_this$ctx$path7","_this$ctx$path8","solLabel","sol","central","_this$ctx$path17","parent","$div","jQuery","_this$ctx$path16","foot","remove","tr2","each","newTd","st","_this$ctx$path15","head","tr","newTh","prepend"],"mappings":"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"}