{"version":3,"file":"refractor.min.js","sources":["../../src/extension/refractor.js"],"sourcesContent":["import {subscribe} from \"../extension\";\nimport {getGlobalConfig} from \"../options\";\nimport Common from '../common';\nimport * as coreStr from \"core/str\";\n\n// List of Bootstrap 4 data attribute suffixes (in kebab-case)\n// that are namespaced in Bootstrap 5.\nconst bs4DataAttributeSuffixes = [\n    // General triggers and component identifiers\n    'toggle',\n    'target',\n    'parent',\n    // Options and configurations\n    'placement',\n    'trigger',\n    'content',\n    'container',\n    'original-title',\n    'html',\n];\n\n // Create a CSS selector string to find elements with any of the BS4 data attributes\n const bs5Selectors = bs4DataAttributeSuffixes.map(suffix => `[data-${suffix}]`).join(',');\n\n/**\n * @param {import(\"../plugin\").TinyMCE} editor\n * @returns {boolean}\n */\nfunction bs5Refractor(editor) {\n    const body = editor.getBody();\n    let changes = 0;\n\n    // Select all elements that match the generated selector.\n    /** @type {HTMLElement[]} */\n    const elementsWithBs4DataAttributes = body.querySelectorAll(bs5Selectors);\n\n    elementsWithBs4DataAttributes.forEach(element => {\n        // Iterate over the list of known BS4 data attribute suffixes\n        bs4DataAttributeSuffixes.forEach(kebabCaseSuffix => {\n            const oldAttrName = `data-${kebabCaseSuffix}`;\n\n            // Check if the element has the old attribute\n            if (element.hasAttribute(oldAttrName)) {\n                const attrValue = element.getAttribute(oldAttrName);\n                const newAttrName = `data-bs-${kebabCaseSuffix}`;\n                // Add or update the new Bootstrap 5 attribute if it's not already set to the correct value.\n                // This \"duplicates\" by ensuring the data-bs-xxx attribute exists with the same value.\n                // It does not remove the old data-xxx attribute in this refactor.\n                if (attrValue !== null) {\n                    if (element.getAttribute(newAttrName) !== attrValue) {\n                        element.setAttribute(newAttrName, attrValue);\n                        changes++;\n                    }\n                } else {\n                    element.removeAttribute(newAttrName);\n                    changes++;\n                }\n            }\n        });\n    });\n\n    return changes > 0;\n}\n\n/**\n * @param {import(\"../plugin\").TinyMCE} editor\n */\nasync function refractoring(editor) {\n    try {\n        const refractoringActive = getGlobalConfig(editor, 'oninit.refractor.bs5', '0');\n        let changes = false;\n        if (refractoringActive === '1') {\n            changes = bs5Refractor(editor);\n        }\n        if (changes) {\n            const saverequired = await coreStr.get_string('saverequired', Common.component);\n            editor.notificationManager.open({\n                text: saverequired,\n                type: 'warning',\n                timeout: 4000\n            });\n        }\n    } catch (ex) {\n        // eslint-disable-next-line no-console\n        console.error(\"Error while applying bs5 refractor:\", ex);\n    }\n}\n\nsubscribe('onInit', refractoring);"],"names":["bs4DataAttributeSuffixes","bs5Selectors","map","suffix","join","editor","refractoringActive","changes","body","getBody","querySelectorAll","forEach","element","kebabCaseSuffix","oldAttrName","hasAttribute","attrValue","getAttribute","newAttrName","setAttribute","removeAttribute","bs5Refractor","saverequired","coreStr","get_string","Common","component","notificationManager","open","text","type","timeout","ex","console","error"],"mappings":"uoCAOMA,yBAA2B,CAE7B,SACA,SACA,SAEA,YACA,UACA,UACA,YACA,iBACA,QAIGC,aAAeD,yBAAyBE,KAAIC,QAAW,SAAQA,YAAWC,KAAK,8BAkE5E,yBArBkBC,kBAEdC,oBAAqB,4BAAgBD,OAAQ,uBAAwB,SACvEE,SAAU,KACa,MAAvBD,qBACAC,iBA5CUF,cACZG,KAAOH,OAAOI,cAChBF,QAAU,SAIwBC,KAAKE,iBAAiBT,cAE9BU,SAAQC,UAElCZ,yBAAyBW,SAAQE,wBACvBC,YAAe,QAAOD,qBAGxBD,QAAQG,aAAaD,aAAc,OAC7BE,UAAYJ,QAAQK,aAAaH,aACjCI,YAAe,WAAUL,kBAIb,OAAdG,UACIJ,QAAQK,aAAaC,eAAiBF,YACtCJ,QAAQO,aAAaD,YAAaF,WAClCT,YAGJK,QAAQQ,gBAAgBF,aACxBX,kBAMTA,QAAU,EAWCc,CAAahB,SAEvBE,QAAS,OACHe,mBAAqBC,QAAQC,WAAW,eAAgBC,gBAAOC,WACrErB,OAAOsB,oBAAoBC,KAAK,CAC5BC,KAAMP,aACNQ,KAAM,UACNC,QAAS,OAGnB,MAAOC,IAELC,QAAQC,MAAM,sCAAuCF"}