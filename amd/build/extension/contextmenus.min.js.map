{"version":3,"file":"contextmenus.min.js","sources":["../../src/extension/contextmenus.js"],"sourcesContent":["/* eslint-disable max-len */\nimport {registerMenuItemProvider} from \"../extension\";\nimport {findVariableByName} from \"../util\";\nimport * as Action from './contextactions';\n\nconst SUPPORTED_LANGS = [\n    {iso: 'ca', title: 'Català'},\n    {iso: 'es', title: 'Castellà'},\n    {iso: 'en', title: 'English'},\n    {iso: 'fr', title: 'Francès'},\n    {iso: 'de', title: 'Alemany'},\n];\n\nconst AVAILABLE_EFFECTS = [\n    {name: 'zoom', title: 'Zoom'},\n    {name: 'lightbox', title: 'Pantalla completa'},\n];\n\nconst SUPPORTED_SIZES = [\n    {v: 'gran', l: 'Gran'},\n    {v: 'mitjana', l: 'Mitjana'},\n    {v: 'petita', l: 'Petita'},\n];\n\n/**\n * @typedef {{type: string, text: string, icon?: string, onAction: (api?: *) => void}} MenuItem\n * @typedef {{name: string, title: string, condition?: string | RegExp | (() => boolean), icon?:string, action?: ()=> void, subMenuItems?: () => string | MenuItem[]}} UserDefinedItem\n */\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {UserDefinedItem[]}\n **/\nfunction provider(ctx) {\n    /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n    const imageEffectsNestedMenu = {\n        name: 'imageEffects',\n        condition: 'imatge',\n        title: 'Efectes d\\'imatge',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            if (!elem) {\n                return '';\n            }\n            if (!elem.attr('data-snptd')) {\n                return AVAILABLE_EFFECTS.map(e => ({\n                    type: 'menuitem',\n                    text: e.title,\n                    onAction: Action.addImageEffectAction(ctx, e.name)\n                }));\n            } else {\n                return [{\n                    type: 'menuitem',\n                    icon: 'remove',\n                    text: 'Treure',\n                    onAction: Action.removeImageEffectsAction(ctx)\n                }];\n            }\n        }\n    };\n\n    /**\n     * Converts a raw image into a snippet\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n    const imageSwitchToSnippet = {\n        name: 'imageSwitchToSnippet',\n        condition: () => {\n           // We are not inside a widget image and the\n           // selectedElement right clicked must be a tag img\n           const key = ctx.path?.widget?.key;\n           const selectedElement = ctx.path?.selectedElement;\n           return (key !== undefined && key !== 'imatge' && key !== 'grid-imatge' &&\n                selectedElement?.prop('tagName') === 'IMG');\n        },\n        title: 'Convertir a snippet imatge',\n        onAction: Action.imageSwitchToSnippetAction(ctx)\n    };\n\n    /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n     const changeBoxLanguageNestedMenu = {\n        name: 'changeBoxLanguage',\n        condition: /capsa-.*|tasca-exercici/,\n        title: 'Idioma',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            if (!elem) {\n                return '';\n            }\n            const currentLang = elem.attr('data-lang') ?? '';\n            return SUPPORTED_LANGS.map(({iso, title}) => ({\n                type: 'menuitem',\n                text: title,\n                icon: iso === currentLang ? 'checkmark' : undefined,\n                onAction: Action.changeBoxLangAction(ctx, iso)\n            }));\n        }\n    };\n\n     /**\n      * @param {import(\"../contextInit\").ItemMenuContext} ctx\n      * @returns {UserDefinedItem}\n      */\n     const changeBoxSizeNestedMenu = {\n        name: 'changeBoxSize',\n        condition: /^capsa-.*|^tasca-exercici$/,\n        title: 'Mida',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            const widget = ctx.path?.widget;\n            if (!elem || !widget) {\n                return '';\n            }\n            const sizes = findVariableByName('mida', widget.parameters)?.options;\n            return (sizes || SUPPORTED_SIZES).map((/** @type {*}*/ e) => ({\n                type: 'menuitem',\n                text: e.l ?? e,\n                icon: elem.hasClass('iedib-capsa-' + (e.v ?? e)) ? 'checkmark' : undefined,\n                onAction: Action.changeBoxSizeAction(ctx, e.v ?? e)\n            }));\n        }\n    };\n\n      /**\n       * @param {import(\"../contextInit\").ItemMenuContext} ctx\n       * @returns {UserDefinedItem}\n       */\n      const changeBoxSeverityNestedMenu = {\n        name: 'changeBoxSeverity',\n        condition: 'capsa-generica',\n        title: 'Tipus',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            const widget = ctx.path?.widget;\n            if (!elem || !widget) {\n                return '';\n            }\n            const severities = findVariableByName('tipus', widget.parameters)?.options;\n            return (severities || []).map((/** @type {*}*/ e) => ({\n                type: 'menuitem',\n                text: e.l ?? e,\n                icon: elem.hasClass('iedib-' + (e.v ?? e) + '-border') ? 'checkmark' : undefined,\n                onAction: Action.changeBoxSeverityAction(ctx, e.v ?? e)\n            }));\n        }\n    };\n\n      /**\n      * @param {import(\"../contextInit\").ItemMenuContext} ctx\n      * @returns {UserDefinedItem}\n      */\n      const switchBoxRowsExample = {\n        name: 'switchBoxRowsExample',\n        condition: 'capsa-exemple-cols',\n        title: 'Convertir a exemple 2 files',\n        onAction: Action.switchBoxRowsExampleAction(ctx)\n    };\n\n     /**\n      * @param {import(\"../contextInit\").ItemMenuContext} ctx\n      * @returns {UserDefinedItem}\n      */\n     const switchBoxSimpleExample = {\n        name: 'switchBoxSimpleExample',\n        condition: 'capsa-exemple-rows',\n        title: 'Convertir a exemple simple',\n        onAction: Action.switchBoxSimpleExampleAction(ctx)\n    };\n\n    /**\n       * @param {import(\"../contextInit\").ItemMenuContext} ctx\n       * @returns {UserDefinedItem}\n       */\n    const numberedListNestedMenu = {\n        name: 'numberedListNestedMenu',\n        condition: () => {\n            const selectedElement = ctx.path?.selectedElement;\n            // TODO:: It must search an OL in the path, probably selectedElement is LI or so!!!!!\n            return selectedElement?.closest(\"ol\")?.[0] !== undefined;\n        },\n        icon: 'list-num-default',\n        title: 'Llista',\n        subMenuItems: () => {\n            return [\n                {\n                    type: 'tooglemenuitem',\n                    text: 'Embellit',\n                    onAction: () => {\n                        // Toggle class\n                    },\n                    onSetup: () => {\n                        // Determine if the class is there\n                    }\n                },\n                {\n                    type: 'menuitem',\n                    text: 'Comença a',\n                    onAction: () => {\n                        // Open input dialog, set the value and retrieve new value\n                    },\n                }\n            ];\n        }\n    };\n\n    return [\n        // Image actions\n        imageEffectsNestedMenu,\n        imageSwitchToSnippet,\n\n        // Box actions\n        changeBoxLanguageNestedMenu,\n        changeBoxSizeNestedMenu,\n        changeBoxSeverityNestedMenu,\n        switchBoxRowsExample,\n        switchBoxSimpleExample,\n\n        // Others\n        numberedListNestedMenu,\n    ];\n}\n\nregisterMenuItemProvider(provider);"],"names":["SUPPORTED_LANGS","iso","title","AVAILABLE_EFFECTS","name","SUPPORTED_SIZES","v","l","ctx","condition","subMenuItems","elem","path","_ctx$path","attr","type","icon","text","onAction","Action","removeImageEffectsAction","map","e","addImageEffectAction","key","_ctx$path2","widget","_ctx$path2$widget","selectedElement","_ctx$path3","undefined","prop","imageSwitchToSnippetAction","_ctx$path4","currentLang","_ref","changeBoxLangAction","_ctx$path5","_ctx$path6","parameters","_findVariableByName","options","hasClass","changeBoxSizeAction","_ctx$path7","_ctx$path8","_findVariableByName2","changeBoxSeverityAction","switchBoxRowsExampleAction","switchBoxSimpleExampleAction","_ctx$path9","closest","onSetup"],"mappings":"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"}