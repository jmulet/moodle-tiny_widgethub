{"version":3,"file":"contextmenus.min.js","sources":["../../src/extension/contextmenus.js"],"sourcesContent":["/* eslint-disable max-len */\n\nimport {registerMenuItemProvider} from \"../extension\";\nimport {findVariableByName} from \"../util\";\nimport * as Action from './contextactions';\n\nconst SUPPORTED_LANGS = [\n    {iso: 'ca', title: 'Català'},\n    {iso: 'es', title: 'Castellà'},\n    {iso: 'en', title: 'English'},\n    {iso: 'fr', title: 'Francès'},\n    {iso: 'de', title: 'Alemany'},\n];\n\nconst AVAILABLE_EFFECTS = [\n    {name: 'zoom', title: 'Zoom'},\n    {name: 'lightbox', title: 'Pantalla completa'},\n];\n\nconst SUPPORTED_SIZES = [\n    {v: 'gran', l: 'Gran'},\n    {v: 'mitjana', l: 'Mitjana'},\n    {v: 'petita', l: 'Petita'},\n];\n\n/**\n * @typedef {{type: string, text: string, icon?: string, onAction: (api?: *) => void}} MenuItem\n * @typedef {{name: string, title: string, widgetKeys?: string[], icon?:string, action?: ()=> void, subMenuItems?: () => string | MenuItem[]}} UserDefinedItem\n */\n\n/**\n * @param {import(\"../contextInit\").ItemMenuContext} ctx\n * @returns {UserDefinedItem[]}\n **/\nfunction provider(ctx) {\n    /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n    const imageEffectsNestedMenu = {\n        name: 'imageEffects',\n        widgetKeys: ['imatge'],\n        title: 'Efectes d\\'imatge',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            if (!elem) {\n                return '';\n            }\n            if (!elem.attr('data-snptd')) {\n                return AVAILABLE_EFFECTS.map(e => ({\n                    type: 'menuitem',\n                    text: e.title,\n                    onAction: Action.addImageEffectAction(ctx, e.name)\n                }));\n            } else {\n                return [{\n                    type: 'menuitem',\n                    icon: 'remove',\n                    text: 'Treure',\n                    onAction: Action.removeImageEffectsAction(ctx)\n                }];\n            }\n        }\n    };\n\n    /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n     const changeBoxLanguageNestedMenu = {\n        name: 'changeBoxLanguage',\n        widgetKeys: ['capsa-generica', 'capsa-exemple-cols', 'capsa-exemple-rows', 'capsa-exemple-simple', 'tasca-exercici'],\n        title: 'Idioma',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            if (!elem) {\n                return '';\n            }\n            const currentLang = elem.attr('data-lang') ?? '';\n            return SUPPORTED_LANGS.map(({iso, title}) => ({\n                type: 'menuitem',\n                text: title,\n                icon: iso === currentLang ? 'checkmark' : undefined,\n                onAction: Action.changeBoxLangAction(ctx, iso)\n            }));\n        }\n    };\n\n     /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n     const changeBoxSizeNestedMenu = {\n        name: 'changeBoxSize',\n        widgetKeys: ['capsa-generica', 'capsa-exemple-cols', 'capsa-exemple-rows', 'capsa-exemple-simple', 'tasca-exercici'],\n        title: 'Mida',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            const widget = ctx.path?.widget;\n            if (!elem || !widget) {\n                return '';\n            }\n            const sizes = findVariableByName('mida', widget.parameters)?.options;\n            return (sizes || SUPPORTED_SIZES).map((/** @type {*}*/ e) => ({\n                type: 'menuitem',\n                text: e.l ?? e,\n                icon: elem.hasClass('iedib-capsa-' + (e.v ?? e)) ? 'checkmark' : undefined,\n                onAction: Action.changeBoxSizeAction(ctx, e.v ?? e)\n            }));\n        }\n    };\n\n      /**\n     * @param {import(\"../contextInit\").ItemMenuContext} ctx\n     * @returns {UserDefinedItem}\n     */\n      const changeBoxSeverityNestedMenu = {\n        name: 'changeBoxSeverity',\n        widgetKeys: ['capsa-generica'],\n        title: 'Tipus',\n        subMenuItems: () => {\n            const elem = ctx.path?.elem;\n            const widget = ctx.path?.widget;\n            if (!elem || !widget) {\n                return '';\n            }\n            const severities = findVariableByName('tipus', widget.parameters)?.options;\n            return (severities || []).map((/** @type {*}*/ e) => ({\n                type: 'menuitem',\n                text: e.l ?? e,\n                icon: elem.hasClass('iedib-' + (e.v ?? e) + '-border') ? 'checkmark' : undefined,\n                onAction: Action.changeBoxSeverityAction(ctx, e.v ?? e)\n            }));\n        }\n    };\n\n    return [\n        // Image actions\n        imageEffectsNestedMenu,\n\n        // Box actions\n        changeBoxLanguageNestedMenu,\n        changeBoxSizeNestedMenu,\n        changeBoxSeverityNestedMenu,\n    ];\n}\n\nregisterMenuItemProvider(provider);"],"names":["SUPPORTED_LANGS","iso","title","AVAILABLE_EFFECTS","name","SUPPORTED_SIZES","v","l","ctx","widgetKeys","subMenuItems","elem","path","_ctx$path","attr","type","icon","text","onAction","Action","removeImageEffectsAction","map","e","addImageEffectAction","_ctx$path2","currentLang","_ref","undefined","changeBoxLangAction","_ctx$path3","widget","_ctx$path4","parameters","_findVariableByName","options","hasClass","changeBoxSizeAction","_ctx$path5","_ctx$path6","_findVariableByName2","changeBoxSeverityAction"],"mappings":"qjCAMMA,gBAAkB,CACpB,CAACC,IAAK,KAAMC,MAAO,UACnB,CAACD,IAAK,KAAMC,MAAO,YACnB,CAACD,IAAK,KAAMC,MAAO,WACnB,CAACD,IAAK,KAAMC,MAAO,WACnB,CAACD,IAAK,KAAMC,MAAO,YAGjBC,kBAAoB,CACtB,CAACC,KAAM,OAAQF,MAAO,QACtB,CAACE,KAAM,WAAYF,MAAO,sBAGxBG,gBAAkB,CACpB,CAACC,EAAG,OAAQC,EAAG,QACf,CAACD,EAAG,UAAWC,EAAG,WAClB,CAACD,EAAG,SAAUC,EAAG,6DAYHC,WAsGP,CAjGwB,CAC3BJ,KAAM,eACNK,WAAY,CAAC,UACbP,MAAO,mBACPQ,aAAc,yBACJC,uBAAOH,IAAII,iCAAJC,UAAUF,YAClBA,KAGAA,KAAKG,KAAK,cAOJ,CAAC,CACJC,KAAM,WACNC,KAAM,SACNC,KAAM,SACNC,SAAUC,OAAOC,yBAAyBZ,OAVvCL,kBAAkBkB,KAAIC,KACzBP,KAAM,WACNE,KAAMK,EAAEpB,MACRgB,SAAUC,OAAOI,qBAAqBf,IAAKc,EAAElB,UAN1C,KAuBkB,CACjCA,KAAM,oBACNK,WAAY,CAAC,iBAAkB,qBAAsB,qBAAsB,uBAAwB,kBACnGP,MAAO,SACPQ,aAAc,0BACJC,wBAAOH,IAAII,kCAAJY,WAAUb,SAClBA,WACM,SAELc,YAAcd,KAAKG,KAAK,cAAgB,UACvCd,gBAAgBqB,KAAIK,WAACzB,IAACA,IAADC,MAAMA,kBAAY,CAC1Ca,KAAM,WACNE,KAAMf,MACNc,KAAMf,MAAQwB,YAAc,iBAAcE,EAC1CT,SAAUC,OAAOS,oBAAoBpB,IAAKP,WASrB,CAC7BG,KAAM,gBACNK,WAAY,CAAC,iBAAkB,qBAAsB,qBAAsB,uBAAwB,kBACnGP,MAAO,OACPQ,aAAc,yDACJC,wBAAOH,IAAII,kCAAJiB,WAAUlB,KACjBmB,0BAAStB,IAAII,kCAAJmB,WAAUD,WACpBnB,OAASmB,aACH,wCAEG,4BAAmB,OAAQA,OAAOE,kDAAlCC,oBAA+CC,UAC5C7B,iBAAiBgB,KAAqBC,KACnDP,KAAM,WACNE,KAAMK,EAAEf,GAAKe,EACbN,KAAML,KAAKwB,SAAS,gBAAkBb,EAAEhB,GAAKgB,IAAM,iBAAcK,EACjET,SAAUC,OAAOiB,oBAAoB5B,IAAKc,EAAEhB,GAAKgB,SASvB,CAClClB,KAAM,oBACNK,WAAY,CAAC,kBACbP,MAAO,QACPQ,aAAc,0DACJC,wBAAOH,IAAII,kCAAJyB,WAAU1B,KACjBmB,0BAAStB,IAAII,kCAAJ0B,WAAUR,WACpBnB,OAASmB,aACH,yCAEQ,4BAAmB,QAASA,OAAOE,mDAAnCO,qBAAgDL,UAC7C,IAAIb,KAAqBC,KAC3CP,KAAM,WACNE,KAAMK,EAAEf,GAAKe,EACbN,KAAML,KAAKwB,SAAS,UAAYb,EAAEhB,GAAKgB,GAAK,WAAa,iBAAcK,EACvET,SAAUC,OAAOqB,wBAAwBhC,IAAKc,EAAEhB,GAAKgB"}