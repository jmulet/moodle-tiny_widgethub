{"version":3,"file":"uiParams.min.js","sources":["../src/uiParams.js"],"sourcesContent":["/* eslint-disable max-len */\n/* eslint-disable no-eq-null */\n/* eslint-disable no-console */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tiny WidgetHub plugin.\n *\n * @module      tiny_widgethub/plugin\n * @copyright   2024 Josep Mulet Pol <pep.mulet@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport ModalFactory from 'core/modal_factory';\nimport {IBParamsModal} from './modal';\nimport ModalEvents from 'core/modal_events';\n// eslint-disable-next-line no-unused-vars\nimport {stream, genID, templateRendererMustache, UserStorage, cleanParameterName, evalInContext, applyWidgetFilter, WidgetWrapper, capitalize, toHexColor} from './util';\nimport {getCourseId, getUserId} from './options';\n// eslint-disable-next-line no-unused-vars\nimport {UiPickCtrl} from './uiPick';\nimport { displayFilepicker } from 'editor_tiny/utils';\nimport { getFilePicker } from 'editor_tiny/options';\nimport jQuery from 'jquery';\n\nconst questionPopover = '{{#tooltip}}<a href=\"javascript:void(0)\" data-toggle=\"popover\" data-trigger=\"hover\" data-content=\"{{tooltip}}\"><i class=\"fa fas fa-question-circle text-info\"></i></a>{{/tooltip}}';\n\nconst Templates = {\n   FIELDTEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group row{{#hidden}} tiny_widgethub-hidden{{/hidden}}\"><label class=\"col-sm-5 col-form-label\" for=\"{{elementid}}_ftmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <div class=\"col-sm-7\"><input type=\"text\" id=\"{{elementid}}_ftmpl\" class=\"form-control\" data-bar=\"{{varname}}\" {{#disabled}}disabled{{/disabled}} value=\"{{defaultvalue}}\"/></div>\n   </div>`,\n\n   IMAGETEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group row{{#hidden}} tiny_widgethub-hidden{{/hidden}}\"><label class=\"col-sm-5 col-form-label\" for=\"{{elementid}}_ftmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <div class=\"col-sm-7\">\n   <input type=\"text\" id=\"{{elementid}}_ftmpl\" class=\"form-control d-inline-block w-75\" data-bar=\"{{varname}}\" {{#disabled}}disabled{{/disabled}} value=\"{{defaultvalue}}\"/>\n   <button class=\"whb-image-picker btn btn-sm btn-secondary d-inline-block\" title=\"Search\"><i class=\"fas fa fa-search\"></i></button>\n   </div>\n   </div>`,\n\n   NUMERICTEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group row{{#hidden}} tiny_widgethub-hidden{{/hidden}}\"><label class=\"col-sm-5 col-form-label\"  for=\"{{elementid}}_fntmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <div class=\"col-sm-7\"><input type=\"number\" id=\"{{elementid}}_fntmpl\" class=\"form-control\" data-bar=\"{{varname}}\" {{{minMax}}} {{#disabled}}disabled{{/disabled}} value=\"{{defaultvalue}}\"/></div>\n   </div>`,\n\n   COLORTEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group row{{#hidden}} tiny_widgethub-hidden{{/hidden}}\"><label class=\"col-sm-5 col-form-label\"  for=\"{{elementid}}_fntmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <div class=\"col-sm-7\"><input type=\"color\" id=\"{{elementid}}_fntmpl\" class=\"form-control\" data-bar=\"{{varname}}\" {{#disabled}}disabled{{/disabled}} value=\"{{defaultvalue}}\"/></div>\n   </div>`,\n\n   TEXTAREATEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group{{#hidden}} tiny_widgethub-hidden{{/hidden}}\"><label for=\"{{elementid}}_tatmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <textarea id=\"{{elementid}}_tatmpl\" rows=\"3\" class=\"form-control\" data-bar=\"{{varname}}\" {{#disabled}}disabled{{/disabled}} {{#tooltip}}title=\"{{tooltip}}\"{{/tooltip}}>{{defaultvalue}}</textarea>\n   </div>`,\n\n   CHECKBOXTEMPLATE: `<div id=\"{{elementid}}\" class=\"d-table w-75 m-2{{#hidden}} tiny_widgethub-hidden{{/hidden}}\">\n   <label>\n   <input title=\"{{varname}}\" id=\"{{elementid}}_cbtmpl\" {{#disabled}}disabled{{/disabled}} type=\"checkbox\" data-bar=\"{{varname}}\" value=\"{{defaultvalue}}\" {{#defaultvalue}}checked{{/defaultvalue}}/></span>\n   {{vartitle}}</label> <span>&nbsp;&nbsp;  ${questionPopover}</span>\n   </div>`,\n\n   SELECTTEMPLATE: `<div id=\"{{elementid}}\" class=\"form-group row{{#hidden}} tiny_widgethub-hidden{{/hidden}}\">\n   <label class=\"col-sm-5 col-form-label\" for=\"{{elementid}}_stmpl\" title=\"{{varname}}\">{{vartitle}} ${questionPopover}</label>\n   <div class=\"col-sm-7\">\n   <select id=\"{{elementid}}_stmpl\" class=\"form-control\" data-bar=\"{{varname}}\" {{#if disabled}}disabled{{/if}} {{#if tooltip}}title=\"{{tooltip}}\"{{/if}}>\n   {{#options}}\n   <option value=\"{{optionValue}}\"{{#selected}} selected{{/selected}}>{{optionLabel}}</option>\n   {{/options}}\n   </select>\n   </div>\n   </div>`\n};\n\nexport class UiParamsCtrl {\n   uiPickCtrl;\n   widget;\n   editor;\n   /**\n    * @param {UiPickCtrl} uiPickCtrl\n    * @param {import('./util').WidgetWrapper} widget\n    */\n   constructor(uiPickCtrl, widget) {\n      this.uiPickCtrl = uiPickCtrl;\n      this.widget = widget;\n      this.editor = uiPickCtrl.editor;\n      this.userStorage = UserStorage.getInstance(getUserId(this.editor), getCourseId(this.editor));\n   }\n   /**\n    * Displays a dialogue for configuring the parameters of the selected snpt\n    */\n   async handleAction() {\n      // Show modal with buttons.\n      const data = await createParametersContext(this.editor, this.widget, this.userStorage);\n      // @ts-ignore\n      const modal = await ModalFactory.create({\n         type: IBParamsModal.TYPE,\n         templateContext: data,\n         large: true,\n      });\n      this.modal = modal;\n      // @ts-ignore\n      modal.getRoot().on(ModalEvents.hidden, () => {\n         // Simply close\n         modal.destroy();\n      });\n      modal.body.find(`a[href=\"#${data.idTabpane}_1\"`).on(\"click\", async() => {\n         // Handle preview;\n         const ctxFromDialogue = getParametersFromForm(this.widget, modal.body.find(\"form\"), null);\n         await this.updatePreview(data.idTabpane, ctxFromDialogue);\n      });\n      attachImagePickers(this.editor, modal.body);\n      modal.footer.show();\n      modal.footer.find(\"button.btn-secondary\").on(\"click\", async() => {\n         // Go back to main menú\n         modal.destroy();\n         await this.uiPickCtrl.handleAction();\n      });\n      modal.footer.find(\"button.btn-primary\").on(\"click\", async() => {\n         // Go back to main menú\n         const ctxFromDialogue = getParametersFromForm(this.widget, modal.body.find(\"form\"), this.userStorage);\n         modal.hide();\n         await this.insertWidget(ctxFromDialogue);\n         modal.destroy();\n      });\n\n      // Change input fields visibilities upon conditions\n      const selectMode = this.editor.selection.getContent().trim() != '';\n      applyFieldWatchers(modal.body, this.widget.defaults, this.widget, selectMode);\n\n      modal.show();\n   }\n\n   destroy() {\n      if (this.modal) {\n         this.modal.destroy();\n      }\n   }\n\n   /**\n    * @param {Object.<string, any>} ctxFromDialogue\n    * @returns {Promise<string>}\n    */\n   async generateInterpolatedCode(ctxFromDialogue) {\n      const sel = this.editor.selection.getContent();\n      // Decideix quin mode de selecció estam\n      console.log(\"Selection\", this.editor.selection, sel);\n      let interpoledComponentCode = await this.widget.render(ctxFromDialogue);\n      if (sel.trim() && this.widget.insertquery) {\n         let query = this.widget.insertquery.trim();\n         let replaceMode = query.startsWith('r!');\n         if (replaceMode) {\n            query = query.substring(2).trim();\n         }\n         // We are in selection mode\n         const tmpDiv = document.createElement(\"div\");\n         tmpDiv.innerHTML = interpoledComponentCode;\n         const insertPoint = tmpDiv.querySelector(this.widget.insertquery);\n         if (insertPoint) {\n            if (replaceMode) {\n               // Replace the insertPoint by the interpolated HTML\n               insertPoint.outerHTML = sel;\n            } else {\n               // Inserts the interpolated HTML into the insertPoint\n               insertPoint.innerHTML = sel;\n            }\n            interpoledComponentCode = tmpDiv.innerHTML;\n         }\n      }\n      return interpoledComponentCode;\n   }\n\n   /**\n    * @param {number} idTabpane\n    * @param {Object.<string, any>} ctxFromDialogue\n    * @returns\n    */\n   async updatePreview(idTabpane, ctxFromDialogue) {\n      const interpoledCode = await this.generateInterpolatedCode(ctxFromDialogue);\n      const $previewPanel = this.modal.body.find(`#${idTabpane}_1`);\n      $previewPanel.html(interpoledCode);\n   }\n\n   /**\n    * @param {Object.<string, any>} ctxFromDialogue\n    * @returns\n    */\n   async insertWidget(ctxFromDialogue) {\n      const recentWidgets = this.userStorage.getFromSession(\"recentsnpt\", \"\").split(\",\").filter(e=>e.trim());\n      const pos = recentWidgets.indexOf(this.widget.key);\n      if (pos >= 0) {\n         recentWidgets.splice(pos, 1);\n      }\n      recentWidgets.unshift(this.widget.key);\n      if (recentWidgets.length > 4) {\n         recentWidgets.splice(5, recentWidgets.length - 4);\n      }\n\n      this.userStorage.setToSession(\"recentsnpt\", recentWidgets.join(\",\"), true);\n\n      if (this.widget.isFilter()) {\n         applyWidgetFilter(this.editor, this.widget.template || '', false, ctxFromDialogue);\n         return;\n      }\n      const interpoledCode = await this.generateInterpolatedCode(ctxFromDialogue);\n      // Normal insert mode\n      this.editor.selection.setContent(interpoledCode);\n      this.editor.focus();\n   }\n}\n\n/**\n * Generates the context to render the modal dialogue with mustache template\n * @param {import('./plugin').TinyMCE} editor\n * @param {WidgetWrapper} widget - the widget for which to show de dialogue\n * @param {UserStorage} userStorage\n * @returns {Promise<Object.<string, any>>} - The generated context\n */\nconst createParametersContext = async(editor, widget, userStorage) => {\n   /** @type {boolean} */\n   const mustSaveAll = userStorage.getFromLocal('saveall', false);\n   /** @type {Object.<string, any>} */\n   const saveAllData = userStorage.getFromLocal('saveall_data', {});\n   /** @type {Object.<string, any>} */\n   const valors = userStorage.getFromLocal(\"valors\", {});\n   const defaults = widget.defaults;\n\n   /**\n    * @param {import('./util').Param} param\n    * @returns {*}\n    */\n   const obtainCurrentValue = function(param) {\n      const sname = widget.name;\n      const pname = param.name;\n      let currentval = defaults[pname];\n      if (mustSaveAll) {\n         // Search the last used value of this parameter\n         if (saveAllData[sname]?.[pname] != null) {\n            currentval = saveAllData[sname][pname];\n         }\n      }\n      if (pname.startsWith(\"$\") && valors[pname]) {\n         currentval = valors[pname];\n      }\n      return currentval;\n   };\n\n   const controls = widget.parameters.map(param =>\n      createControlHTML(editor.id, param, obtainCurrentValue(param)));\n\n   const ctx = {\n      idTabpane: genID(),\n      selectMode: editor.selection.getContent().trim().length > 0,\n      name: widget.name,\n      instructions: widget.instructions,\n      filter: widget.isFilter(),\n      controls: controls\n   };\n   return ctx;\n};\n\n/**\n * Generates the HTML to render the control associated with the parameter\n * @param {string} hostId - The id of the editor\n * @param {import('./util').Param} param - The parameter object defining the control\n * @param {any} defaultValue - Default values for all parameters\n * @returns {string} - The generated HTML for this control\n */\nexport const createControlHTML = function(hostId, param, defaultValue) {\n   let template = '';\n   const pname = cleanParameterName(param.name);\n   const generalCtx = {\n      elementid: hostId + \"_\" + pname,\n      varname: pname,\n      vartitle: param.title,\n      defaultvalue: defaultValue,\n      tooltip: param.tip || param.tooltip,\n      disabled: param.editable === false,\n      hidden: param.hidden === true\n   };\n   if (param.type === 'textarea') {\n      template = templateRendererMustache(Templates.TEXTAREATEMPLATE, generalCtx);\n   } else if (param.type === 'numeric') {\n      let minMax = \"\";\n      if (param.min) {\n         minMax += `min=\"${param.min}\"`;\n      }\n      if (param.max) {\n         minMax += ` max=\"${param.max}\"`;\n      }\n      template = templateRendererMustache(Templates.NUMERICTEMPLATE, {minMax: minMax, ...generalCtx});\n   } else if (param.type === 'checkbox') {\n      template = templateRendererMustache(Templates.CHECKBOXTEMPLATE, generalCtx);\n   } else if (param.type === 'select') {\n      const options = (param.options ?? []).map(opt => {\n         let label;\n         let value;\n         if (typeof opt === 'string') {\n            label = capitalize(opt);\n            value = opt;\n         } else {\n            label = opt.l;\n            value = opt.v;\n         }\n         return {optionLabel: label, optionValue: value, selected: value === defaultValue};\n      });\n      template = templateRendererMustache(Templates.SELECTTEMPLATE, {options, ...generalCtx});\n   } else if (param.type === 'color') {\n      // Value must be in hex form\n      generalCtx.defaultvalue = toHexColor(generalCtx.defaultvalue);\n      template = templateRendererMustache(Templates.COLORTEMPLATE, generalCtx);\n   } else if (param.type === 'image') {\n      template = templateRendererMustache(Templates.IMAGETEMPLATE, generalCtx);\n   } else {\n      // Assume textfield\n      template = templateRendererMustache(Templates.FIELDTEMPLATE, generalCtx);\n   }\n   return template;\n};\n\n\n/**\n * Obtains the updated parameter values from the modal\n * This is used in insertWidget\n * @param {WidgetWrapper} widget\n * @param {JQuery<HTMLElement>} form\n * @param {UserStorage?} userStorage\n * @returns {Object.<string, any>} - The updated parameters dict\n */\nexport const getParametersFromForm = (widget, form, userStorage) => {\n   /** @type {Object.<string, any>}  */\n   const ctx = {};\n   /** @type {Object.<string, any>}  */\n   const toPersist = {};\n   const defaults = widget.defaults;\n   widget.parameters.forEach(param => {\n      const pname = param.name;\n      const cleanPname = cleanParameterName(pname);\n      const $elem = form.find(`[data-bar=\"${cleanPname}\"]`);\n      if (!$elem.length) {\n         ctx[pname] = defaults[pname];\n         return;\n      }\n      /** @type {*} */\n      let value = $elem.val() || \"\";\n      if ($elem.prop(\"tagName\") === \"INPUT\" && $elem.attr(\"type\") === \"checkbox\") {\n         value = $elem.is(':checked');\n      } else if (param.transform) {\n         value = stream(param.transform).reduce(value);\n      }\n      ctx[pname] = value;\n      if (pname.trim().startsWith(\"$\")) {\n         toPersist[pname] = value;\n      }\n   });\n   if (userStorage) {\n      if (Object.keys(toPersist).length) {\n         // Only those starting with $\n         userStorage.setToLocal('valors', toPersist, true);\n      }\n      // Should all values be persisted?\n      const mustSaveAll = userStorage.getFromLocal('saveall', false);\n      if (mustSaveAll) {\n         /** @type {Object.<string, any>}  */\n         const previousAllData = userStorage.getFromLocal('saveall_data', {});\n         previousAllData[widget.name] = {...ctx};\n         userStorage.setToLocal('saveall_data', previousAllData, true);\n      }\n   }\n   return ctx;\n};\n\n/**\n * @param {import('./plugin').TinyMCE} editor\n * @param {JQuery<HTMLElement>} body - The modal body\n */\nexport const attachImagePickers = function(editor, body) {\n    // console.log('moodle:filepickers', this.editor.options.get('moodle:filepickers'));\n    const canShowFilePicker = typeof getFilePicker(editor, 'image') !== 'undefined';\n    const picker = body.find('button.whb-image-picker').prop('disabled', !canShowFilePicker);\n    if (canShowFilePicker) {\n       // Attach a click handler to any image-picker buttons\n       picker.on(\"click\", /** @param {any} evt */ async(evt) => {\n          evt.preventDefault();\n          try {\n             /** @type {any} */\n             const params = await displayFilepicker(editor, 'image');\n             if (params?.url) {\n                jQuery(evt.currentTarget).parent().find('input').val(params.url);\n             }\n          } catch (ex) {\n             console.error(ex);\n          }\n       });\n   }\n};\n\n/**\n * @param {JQuery<HTMLElement>} $formElem\n * @param {Object.<string, any>} defaultsData\n * @param {WidgetWrapper} widget\n * @param {boolean} selectMode\n */\nexport const applyFieldWatchers = function($formElem, defaultsData, widget, selectMode) {\n   /** @type {string[]} */\n   const watchedvars = []; // All these variable names must be watched\n   /**\n    * all these components must be updated when one watcher changes\n    *  @type {{\n    *    condition: string,\n    *    component: JQuery<HTMLElement>,\n    *    type: string,\n    *    indx: number\n    *  }[]}\n    */\n   const updatableComponents = [];\n\n   const regex = /\\{{2}([^}]*)\\}{2}/gm;\n   for (let indx = 0, len = widget.parameters.length; indx < len; indx++) {\n\n      const varobj = widget.parameters[indx];\n\n      if (varobj.when) {\n         const condition = varobj.when;\n         const t = varobj.type;\n         const control = $formElem.find(`[data-bar=\"${cleanParameterName(varobj.name)}\"]`);\n         if (!control.length || !t) {\n            continue;\n         }\n         updatableComponents.push({\n            condition: condition.replace(/[{}]{2}/g, ''),\n            component: control,\n            indx: indx,\n            type: t\n         });\n         const varsInvolved = condition.match(regex);\n         varsInvolved?.forEach(evar => {\n            evar = evar.replace(/[{}]*/g, '').trim();\n            // Can only watch real variables SELECT_MODE is not a variable\n            console.log(\"evar\", evar, defaultsData);\n            if (watchedvars.indexOf(evar) < 0 && defaultsData[evar] != null) {\n               console.log(\"ADDED AS WATCH\");\n               watchedvars.push(evar);\n            }\n         });\n      }\n      watchedvars.push(varobj.name);\n   }\n\n   console.log(watchedvars);\n   console.log(updatableComponents);\n\n\n   const doUpdateVisibilities = () => {\n      updatableComponents.forEach(cc => {\n         // Evaluate condition\n         console.log(\"Amagant \", cc);\n         const condicio = cc.condition;\n         const novesVariables = getParametersFromForm(widget, $formElem, null);\n         console.log(\"Obtained the new variables from the form \", novesVariables);\n         // Add to the new variables the internal variables\n         novesVariables.SELECT_MODE = selectMode;\n         // Eval JS condition for new variables\n         const showme = evalInContext(novesVariables, condicio);\n         let theComponent = cc.component;\n         if (theComponent) {\n            theComponent = theComponent.parent();\n            if (cc.type === 'checkbox') {\n               theComponent = theComponent.parent();\n            }\n            // Only change visibilities of nodes not hidden from user\n            console.log(\"Changing visibilities of \", theComponent, \" condition \", condicio, \" evals to \", showme);\n            if (!theComponent.attr('data-amagat')) {\n               if (showme) {\n                  theComponent.show();\n               } else {\n                  theComponent.hide();\n               }\n            }\n         }\n      });\n   };\n\n   // Apply the watchers\n   widget.parameters.forEach((varobj) => {\n      const control = $formElem.find(`[data-bar=\"${cleanParameterName(varobj.name)}\"]`);\n      if (watchedvars.indexOf(varobj.name) < 0 || !control) {\n         return;\n      }\n      console.log(\"that must be watched\", varobj);\n      let evtName = \"change\";\n      if (varobj.type === 'textfield' || varobj.type === 'textarea') {\n         evtName = \"keyup\";\n      }\n      control.on(evtName, (e) => {\n         console.log(e);\n         doUpdateVisibilities();\n      });\n   });\n\n   // Decide which form elements are visible accoding to the current values of the parameters.\n   doUpdateVisibilities();\n};\n"],"names":["questionPopover","Templates","FIELDTEMPLATE","IMAGETEMPLATE","NUMERICTEMPLATE","COLORTEMPLATE","TEXTAREATEMPLATE","CHECKBOXTEMPLATE","SELECTTEMPLATE","uiPickCtrl","widget","editor","constructor","userStorage","UserStorage","getInstance","this","data","createParametersContext","modal","ModalFactory","create","type","IBParamsModal","TYPE","templateContext","large","getRoot","on","ModalEvents","hidden","destroy","body","find","idTabpane","async","ctxFromDialogue","getParametersFromForm","updatePreview","attachImagePickers","footer","show","handleAction","hide","insertWidget","selectMode","selection","getContent","trim","applyFieldWatchers","defaults","sel","console","log","interpoledComponentCode","render","insertquery","query","replaceMode","startsWith","substring","tmpDiv","document","createElement","innerHTML","insertPoint","querySelector","outerHTML","interpoledCode","generateInterpolatedCode","html","recentWidgets","getFromSession","split","filter","e","pos","indexOf","key","splice","unshift","length","setToSession","join","isFilter","template","setContent","focus","mustSaveAll","getFromLocal","saveAllData","valors","controls","parameters","map","param","createControlHTML","id","sname","name","pname","currentval","obtainCurrentValue","instructions","hostId","defaultValue","generalCtx","elementid","varname","vartitle","title","defaultvalue","tooltip","tip","disabled","editable","minMax","min","max","options","opt","label","value","l","v","optionLabel","optionValue","selected","form","ctx","toPersist","forEach","cleanPname","$elem","val","prop","attr","is","transform","reduce","Object","keys","setToLocal","previousAllData","canShowFilePicker","picker","evt","preventDefault","params","url","currentTarget","parent","ex","error","$formElem","defaultsData","watchedvars","updatableComponents","regex","indx","len","varobj","when","condition","t","control","push","replace","component","varsInvolved","match","evar","doUpdateVisibilities","cc","condicio","novesVariables","SELECT_MODE","showme","theComponent","evtName"],"mappings":"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"}